
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>hplonline</title>
  <meta name="author" content="hplonline">

  
  <meta name="description" content="(hplonline)2010.1.10
(..I found my installed ubuntu an English version without Chinese IMEs &#8230;
I&#8217;ll try to solve it later . Now , it&#8217 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://hupili.github.io/backup-hplonline/blog/page/7">
  <link href="/backup-hplonline/favicon.png" rel="icon">
  <link href="/backup-hplonline/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/backup-hplonline/atom.xml" rel="alternate" title="hplonline" type="application/atom+xml">
  <script src="/backup-hplonline/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/backup-hplonline/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/backup-hplonline/">hplonline</a></h1>
  
    <h2>backup from 2006 to 2012 (original hi.baidu.com/hplonline/)</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/backup-hplonline/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:hupili.github.io/backup-hplonline" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/backup-hplonline/">Blog</a></li>
  <li><a href="/backup-hplonline/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/backup-hplonline/blog/2010/01/10/generatingRFCcontentwiththehelpofVIM%26%2339%3Bsplugins%28taglist.vim%2Btxt.vim%29/">Generating RFC Content With the Help of VIM&#39;s plugins(taglist.vim+txt.vim)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-10T14:05:00+08:00" pubdate data-updated="true">Jan 10<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>(hplonline)2010.1.10<br/><br/>
(..I found my installed ubuntu an English version without Chinese IMEs &#8230;<br/>
I&#8217;ll try to solve it later . Now , it&#8217;s OK to just work without Chinese words ,<br/>
for most of the  materials we get from internet are in English ..<br/>
this is the FIRST blog under Linux .)<br/><br/>
A few months ago , when I started to read RFCs , I found it&#8217;s disturbing <br/>
switching from chapter to chapter . But we can do nothing , since all the <br/>
documents are in plain text &#8230; One thing I tried hard to do is CTRL+F from <br/>
here to there . Another is writting a toy program ( <a href="http://hi.baidu.com/hplonline/blog/item/b7f4a2d39e567e3e960a1659.html" target="_blank">see here</a> ..) to generate <br/>
contents for these documents .<br/><br/>
Yesterday , I came across the idea PLUGINs . So I surfed pages of www.vim.org<br/>
to hunt for some interesting ones . The one named txt.vim flashed in front <br/>
of my eyes . It look like this when installed properly . take <a href="http://www.ietf.org/rfc/rfc3000.txt" target="_blank">RFC3000</a> for example :<br/><br/><span><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/1d1e3bad1dd9fa384a36d636.jpg" small="0" class="blogimg"/></span><br/><br/>
you can now jump to a topic by just moving the cursor to the headlines and <br/>
pressing RETURN . What&#8217;s more , I defined some function keys F5-F8 to <br/>
operate the taglist&#8217;s bar easily (see notes below) . <br/><br/>
It seems one can define syntax rules for further use of this plugin <br/>
with a variety of txt formats .<br/><br/><font color="#0000ff">my NOTES today :</font><br/><br/>
&gt;&gt;help analyze plain text <br/><br/>
download:<br/><br/><a href="http://www.vim.org/scripts/script.php?script_id=2899" target="_blank">http://www.vim.org/scripts/script.php?script_id=2899</a><br/><br/>
the &#8216;txt.txt&#8217; in the zip archive shows <br/>
exactly how to install the plugin in chapter 3.<br/><br/>
it needs to install taglis first ..<br/>
so I turned to taglist<br/><br/>
download:<br/><br/><a href="http://www.vim.org/scripts/script.php?script_id=273" target="_blank">http://www.vim.org/scripts/script.php?script_id=273</a><br/><br/>
however , when vim is launched , I get this message ..<br/><br/><font color="#ff0000">Taglist: Exuberant ctags (http://ctags.sf.net) not found in PATH. Plugin is not loaded.</font><br/><br/>
so I install the ctags :<br/><br/><font color="#ff9900">sudo apt-get install exuberant-ctags</font><br/><br/>
&gt;&gt;about plugins<br/><br/>
vim plugins are all in ~/.vim/plugin . <br/>
the subdirectory is not that important .<br/>
vim will search the whole plugin directory for that . <br/><br/>
but to FILETYPE plugins , vim should associate the <br/>
filetype with the plugin&#8217;s name . so , the three <br/>
available ways look like this:<br/><font color="#ff9900">    ftplugin/&lt;filetype&gt;.vim<br/>
ftplugin/&lt;filetype&gt;_&lt;name&gt;.vim<br/>
ftplugin/&lt;filetype&gt;/&lt;name&gt;.vim</font><br/><br/>
&gt;&gt;about removing plugins<br/><br/>
simply to remove the related files from doc/ or plugin/ , <br/>
like <em>.vim in plugin/ , </em>.txt in doc/<br/><br/>
&gt;&gt;taglis operation:(from mannual , listed here for quick reference)<br/><br/>
&lt;CR&gt;          Jump to the location where the tag under cursor is<br/>
defined.<br/>
o             Jump to the location where the tag under cursor is<br/>
defined in a new window.<br/>
P             Jump to the tag in the previous (Ctrl-W_p) window.<br/>
p             Display the tag definition in the file window and<br/>
keep the cursor in the taglist window itself.<br/>
t             Jump to the tag in a new tab. If the file is already<br/>
opened in a tab, move to that tab.<br/>
Ctrl-t        Jump to the tag in a new tab.<br/>
&lt;Space&gt;       Display the prototype of the tag under the cursor.<br/>
For file names, display the full path to the file,<br/>
file type and the number of tags. For tag types, display the<br/>
tag type and the number of tags.<br/>
u             Update the tags listed in the taglist window<br/>
s             Change the sort order of the tags (by name or by order)<br/>
d             Remove the tags for the file under the cursor<br/>
x             Zoom-in or Zoom-out the taglist window<br/>
+             Open a fold<br/>
-             Close a fold<br/>
*             Open all folds<br/>
=             Close all folds<br/>
[[            Jump to the beginning of the previous file<br/>
&lt;Backspace&gt;   Jump to the beginning of the previous file<br/>
]]            Jump to the beginning of the next file<br/>
&lt;Tab&gt;         Jump to the beginning of the next file<br/>
q             Close the taglist window<br/>
&lt;F1&gt;          Display help<br/><br/>
&gt;&gt;setup accelerated keys <br/>
add these lines in the file $HOME/.vimrc<br/><br/><font color="#ff9900">nmap &lt;F8&gt; &lt;ESC&gt;:TlistOpen&lt;RETURN&gt;<br/>
nmap &lt;F7&gt; &lt;ESC&gt;:TlistClose&lt;RETURN&gt;<br/>
nmap &lt;F6&gt; &lt;ESC&gt;:Tlist&lt;RETURN&gt;<br/>
nmap &lt;F5&gt; &lt;ESC&gt;:TlistUpdate&lt;RETURN&gt;</font><br/><br/>
I even add another function key :<br/><font color="#ff9900">nmap &lt;F2&gt; &lt;ESC&gt;:w&lt;RETURN&gt;</font><br/>
in my memory of high school  times..<br/>
it&#8217;s the key I used most frequently . ( free PASCAL&#8217;s convetion)<br/>
like CTRL+S in word ,  F2 is very important for saving our works . <br/>
And as coder , when I get stuck in thoughts , it&#8217;s the only &#8216;safe&#8217; key<br/>
to press as I wish . This may be a bad habit like children biting their <br/>
pencils when thinking  . However , it&#8217;s hard to get rid of it .<br/></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/backup-hplonline/blog/2010/01/09/%E4%B8%80%E5%A5%97%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%EF%BC%88ubuntu%2Cvi%2Cbash%2Cgcc%2Cgdb%2Coctave%29/">一套工作环境（ubuntu,vi,bash,gcc,gdb,octave)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-09T16:06:00+08:00" pubdate data-updated="true">Jan 9<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content">
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/backup-hplonline/blog/2010/01/08/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%87%BD%E6%95%B0%EF%BC%88C%2CLinux%EF%BC%89/">环境变量函数（C,Linux）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-08T19:39:00+08:00" pubdate data-updated="true">Jan 8<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>(hplonline)2010.1.8</p>


<p>linux下c的stdlib里面带有几个操作环境变量的函数。<br/><font color="#ff9900">getenv , putenv , setenv , unsetenv</font><br/>
其中putenv的功能在setenv下面显得冗余了。<br/>
不过调用方式有点小区别，<br/>
用不着怎么描述，看代码就知道了。</p>


<p>另外想起了弄个宏<br/><font color="#ff0000">#define S(x) printf(&#8220;%s\n&#8221; , #x) ; x ;</font> <br/>
这样在shell上观察语句效果比较方便，<br/>
便于学习各种函数时使用。</p>


<p><font color="#0000ff">示例代码：</font></p>


<p>#include &lt;stdio.h&gt;<br/>
#include &lt;stdlib.h&gt;</p>


<p>#define S(x) printf(&#8220;%s\n&#8221; , #x) ; x ;</p>


<p>void print_env(char *name){<br/>
     char *buf ;<br/>
     buf = getenv(name) ;<br/>
     printf(&#8220;%s:\n%s\n\n&#8221; , name , buf) ;<br/>
}</p>


<p>int main(){<br/>
     char *buf ;<br/>
     //test of getenv in function print_env<br/>
     //show the variable PATH<br/>
     S(print_env(&#8220;PATH&#8221;) ;)<br/>
     //print a variable that not exists<br/>
     print_env(&#8220;HPL&#8221;) ;<br/>
     //try to put an variable through putenv<br/>
     S(putenv(&#8220;HPL=1&#8221;) ;)<br/>
     print_env(&#8220;HPL&#8221;) ;<br/>
     //try to put an variable through setenv<br/>
     S(setenv(&#8220;HPL2&#8221; , &#8220;2&#8221; , 1) ;)<br/>
     print_env(&#8220;HPL2&#8221;) ;<br/>
     //try the difference of override flag of setenv<br/>
     S(setenv(&#8220;HPL2&#8221; , &#8220;3&#8221; , 0) ;)<br/>
     print_env(&#8220;HPL2&#8221;) ;<br/>
     S(setenv(&#8220;HPL2&#8221; , &#8220;3&#8221; , 1) ;)<br/>
     print_env(&#8220;HPL2&#8221;) ;<br/>
     //try removing variables<br/>
     S(unsetenv(&#8220;HPL&#8221;) ;)<br/>
     S(unsetenv(&#8220;HPL2&#8221;) ;)<br/>
     print_env(&#8220;HPL&#8221;) ;<br/>
     print_env(&#8220;HPL2&#8221;) ;</p>


<p>     S(printf(&#8220;aaaa&#8221;)) ;</p>


<p>     return 0 ;<br/>
}</p>


<p>看通原很郁闷，<br/>
正好vim配方便了，手痒。</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/backup-hplonline/blog/2010/01/08/%E6%94%B6%E8%97%8F%E4%B8%80%E4%B8%AAvim%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E3%80%82/">收藏一个vim的配置文件。</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-08T18:37:00+08:00" pubdate data-updated="true">Jan 8<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><br/>
收藏一个vim的配置文件。<br/>
来源：<a target="_blank" href="http://hi.baidu.com/totrit">T哥</a>（的同学，据说去年睡过我上铺）。</p>


<p>之前也用vi小写了几个东西，<br/>
感觉很不爽。<br/>
比如tab，一打就是8个空，<br/>
跟dev的感觉一样，特难看。。<br/>
还有在编辑模式按方向键和鼠标滚轮，<br/>
会很囧地出现A等字符。<br/>
再然后不会自动缩进，<br/>
几行的代码就不说了，<br/>
要是代码多了，<br/>
这手动空格实在是很麻烦。</p>


<p>这个配置文件都给解决了。。一用感觉爽多了。</p>


<p>保存在用户目录下，比如我的：<br/><font color="#ff9900">/home/hpl/.vimrc</font></p>


<p><font color="#0000ff">配置文件：</font></p>


<p>nmap &lt;C-_&gt;s :cs find s &lt;C-R&gt;=expand(&#8220;&lt;cword&gt;&#8221;)&lt;CR&gt;&lt;CR&gt;<br/>
nmap &lt;C-_&gt;g :cs find g &lt;C-R&gt;=expand(&#8220;&lt;cword&gt;&#8221;)&lt;CR&gt;&lt;CR&gt;<br/>
nmap &lt;C-_&gt;c :cs find c &lt;C-R&gt;=expand(&#8220;&lt;cword&gt;&#8221;)&lt;CR&gt;&lt;CR&gt;<br/>
nmap &lt;C-_&gt;t :cs find t &lt;C-R&gt;=expand(&#8220;&lt;cword&gt;&#8221;)&lt;CR&gt;&lt;CR&gt;<br/>
nmap &lt;C-_&gt;e :cs find e &lt;C-R&gt;=expand(&#8220;&lt;cword&gt;&#8221;)&lt;CR&gt;&lt;CR&gt;<br/>
nmap &lt;C-_&gt;f :cs find f &lt;C-R&gt;=expand(&#8220;&lt;cfile&gt;&#8221;)&lt;CR&gt;&lt;CR&gt;<br/>
nmap &lt;C-_&gt;i :cs find i ^&lt;C-R&gt;=expand(&#8220;&lt;cfile&gt;&#8221;)&lt;CR&gt;$&lt;CR&gt;<br/>
nmap &lt;C-_&gt;d :cs find d &lt;C-R&gt;=expand(&#8220;&lt;cword&gt;&#8221;)&lt;CR&gt;&lt;CR&gt;</p>


<p>set sm<br/>
set ai</p>


<p>if v:lang =~ &#8220;utf8$&#8221; || v:lang =~ &#8220;UTF-8$&#8221;<br/>
    set fileencodings=ucs-bom,utf-8,latin1<br/>
endif</p>


<p>set tabstop=4</p>


<p>set nocompatible &#8221; Use Vim defaults (much better!)<br/>
set bs=indent,eol,start   &#8221; allow backspacing over everything in insert mode<br/>
&#8220;set ai    &#8221; always set autoindenting on<br/>
&#8220;set backup   &#8221; keep a backup file<br/>
set viminfo=&#8217;20,&#34;50 &#8221; read/write a .viminfo file, don&#8217;t store more<br/>
    &#8221; than 50 lines of registers<br/>
set history=50   &#8221; keep 50 lines of command line history<br/>
set ruler   &#8221; show the cursor position all the time</p>


<p>&#8221; Only do this part when compiled with support for autocommands<br/>
if has(&#8220;autocmd&#8221;)<br/>
  augroup fedora<br/>
  autocmd!<br/>
  &#8221; In text files, always limit the width of text to 78 characters<br/>
  autocmd BufRead *.txt set tw=78<br/>
  &#8221; When editing a file, always jump to the last cursor position<br/>
  autocmd BufReadPost *<br/>
  \ if line(&#8220;&#8217;&#34;&#8221;) &gt; 0 &amp;&amp; line (&#8220;&#8217;&#34;&#8221;) &lt;= line(&#8220;$&#8221;) |<br/>
  \    exe &#8220;normal! g&#8217;&#34;&#8221; |<br/>
  \ endif<br/>
  &#8221; don&#8217;t write swapfile on most commonly used directories for NFS mounts or USB sticks<br/>
  autocmd BufNewFile,BufReadPre /media/*,/mnt/* set directory=~/tmp,/var/tmp,/tmp<br/>
  &#8221; start with spec file template<br/>
  autocmd BufNewFile *.spec 0r /usr/share/vim/vimfiles/template.spec<br/>
  augroup END<br/>
endif</p>


<p>if has(&#8220;cscope&#8221;) &amp;&amp; filereadable(&#8220;/usr/bin/cscope&#8221;)<br/>
    set csprg=/usr/bin/cscope<br/>
    set csto=0<br/>
    set cst<br/>
    set nocsverb<br/>
    &#8221; add any database in current directory<br/>
    if filereadable(&#8220;cscope.out&#8221;)<br/>
       cs add cscope.out<br/>
    &#8221; else add database pointed to by environment<br/>
    elseif $CSCOPE_DB != &#8220;&#8221;<br/>
       cs add $CSCOPE_DB<br/>
    endif<br/>
    set csverb<br/>
endif</p>


<p>&#8221; Switch syntax highlighting on, when the terminal has colors<br/>
&#8221; Also switch on highlighting the last used search pattern.<br/>
if &amp;t_Co &gt; 2 || has(&#8220;gui_running&#8221;)<br/>
  syntax on<br/>
  set hlsearch<br/>
endif</p>


<p>&#8221; filetype plugin on</p>


<p>if &amp;term==&#8221;xterm&#8221;<br/>
      set t_Co=8<br/>
      set t_Sb= [4%dm<br/>
      set t_Sf= [3%dm<br/>
endif</p>


<p>set nu<br/>
&#8221; Don&#8217;t wake up system with blinking cursor:<br/>
&#8221; <a href="http://www.linuxpowertop.org/known.php">http://www.linuxpowertop.org/known.php</a><br/>
&#8221; let &amp;guicursor = &amp;guicursor . &#8220;,a:blinkon0&#8221;</p>


<p><br/><font color="#0000ff">解释：</font></p>


<p>东西比较多，只记录一下关心的几条。<br/>
就是前面提到过的那些戳瓢之处，<br/>
看看是怎么改进的。</p>


<p>set sm<br/>
貌似括号配对，闪烁提示<br/>
set ai<br/>
打开自动缩进<br/>
set nu<br/>
显示行号<br/>
set tabstop=4<br/>
tab换4个空格<br/>
set bs=indent,eol,start <br/>
这样就可以用退格删除缩进，退格到上一行等</p>


<p>另外由于在win下拷来拷去，<br/>
又用IE打开，又发在网页上。<br/>
难免有些字符替换问题。<br/>
（经常见到很多囧死人的网络代码）</p>


<p><font color="#ff0000">如果打开vi报错的话，<br/>
用&#8221;（英文双引号）注视掉报错的行号吧。</font></p>


<p>应该不会影响多少使用。</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/backup-hplonline/blog/2010/01/06/shell%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E3%80%82%E3%80%82%EF%BC%88%E8%9B%8B%E7%96%BC%E4%BA%86%E4%B8%80%E4%B8%AA%E6%B1%89%E8%AF%BA%E5%A1%94%EF%BC%89/">Shell中的函数。。（蛋疼了一个汉诺塔）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-06T22:04:00+08:00" pubdate data-updated="true">Jan 6<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>(hplonline)2010.1.6<br/><br/>
去年弄了下shell，<br/>
练了些基本的东西和分支、循环那些。<br/>
今天想起试了下函数。<br/><br/><font color="#0000ff">note：</font><br/><br/>
函数定义 <br/><br/>
myfun(){<br/>
cmd1<br/>
cmd2<br/>
}<br/><br/>
function myfun(){<br/>
cmd1<br/>
cmd2<br/>
}<br/><br/>
函数内部可以以$1,$2等引用参数<br/><font color="#ff0000">$0仍然表示整个脚本的文件名</font><br/><br/>
调用<br/>
myfun arg1 arg2 arg3<br/><br/>
可以在函数外面用declare声明全局变量。<br/>
在函数内声明的变量不会带到函数外面。<br/><br/><font color="#0000ff">汉诺塔：</font><br/><pre>#!/bin/bash<br/>#2010/1/6<br/>#by hpl<br/>#solving hanoi tower problem <br/>#just for fun and practise the usage of function <br/><br/>declare -i total #total steps used by the script<br/>function solve(){<br/>if [ "$4" != "0" ] ; then<br/>total=total+1<br/>declare -i n=$4<br/>declare -i nn=n-1<br/>solve $1 $3 $2 $nn <br/>echo "move from $1 to $3"<br/>solve $2 $1 $3 $nn <br/>fi<br/>}<br/><br/>echo "please input the number of pieces n="<br/>read n <br/>echo "hey buddy , follow my steps:"<br/>echo "(the stub are named a,b,c from left to right)"<br/>total=0<br/>solve a b c $n<br/>echo "total steps used : $total"</pre>
<font color="#0000ff">运行示例：<br/></font><br/><pre>hpl@ubuntu:~/Desktop/myscripts$ ./hanoi<br/>please input the number of pieces n=<br/>3<br/><font color="#ff00ff">hey buddy , follow my steps:<br/>(the stub are named a,b,c from left to right)<br/>move from a to c<br/>move from a to b<br/>move from c to b<br/>move from a to c<br/>move from b to a<br/>move from b to c<br/>move from a to c<br/>total steps used : 7</font><br/><font color="#0000ff"><br/>感想：</font><br/><br/>这shell里面像if ，for ，while ，until 等等，<br/>语法都很奇怪。。真的是非常奇怪。。<br/>目前相当不熟悉，办起事来没直接用C写来得快。<br/><br/>但是linux的fanboys老是说shell很牛X。<br/>我想一方面是因为他本身有成为牛X的潜力，<br/>另一方面是因为用多了的原因。<br/><br/>好比一个最基础的问题，<br/>是刀厉害还是剑厉害。。<br/>这完全要看是在谁手里了，<br/>据说高手都是用内力的。<br/><br/>如果一个人天天shell，自然会觉得很爽很有效率。<br/><br/>不过潜力也是不可忽视的，<br/>比如DOS的批处理，先天就差一截。<br/>再怎么天天用，也不会高效到和linux的shell相比。</pre></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/backup-hplonline/blog/2010/01/01/Goertzel%E7%AE%97%E6%B3%95/">Goertzel算法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-01T15:26:00+08:00" pubdate data-updated="true">Jan 1<span>st</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>(hplonline)2010.1.1<br/><br/>
今天突然又提起了这个名字，<br/>
于是决定看个究竟是什么样的东西。<br/><br/>
在网上翻了一下，<br/>
看了一篇博客，一个网页，一篇paper。。<br/>
本来是个很简单的东西，<br/>
却把国人粗制滥造的精神体现得淋漓尽致。。。<br/><br/>
于是我就一点一点来说吧，<br/>
里面用到的公式和图就直接截别人做的了，<br/>
这样更加真实地反映我们能从网络得到什么。<br/><br/><font color="#0000ff">该算法的意义：</font><br/><br/>
如果搜一下的话，会看到到处说是DFT的快速计算方法。<br/>
然后会提到如DTMF这样的东西。<br/>
其实就是两点：<br/><font color="#ff0000">1.有的时候只关心部分频率分量，不需要计算所有分量。<br/>
2.希望边读入边计算 ，而不是读取完整一帧后才能计算。</font><br/><br/><font color="#0000ff">基本原理：</font><br/><br/><span><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/f437ed11f56b62f7a6ef3ffb.jpg" small="0" class="blogimg"/></span><br/>
（图来自http://www.dzsc.com/data/html/2008-12-16/75269.html）<br/><br/>
这张图还是不错，根据这个意思就知道整个递推过程应该是怎样的。<br/>
这个有点像基础算法中提到的多项式求值问题。<br/>
这样加乘迭代进行可以减少乘法次数。<br/>
但这是次要问题，主要在于可以边输入边计算。<br/><br/>
具体的一阶系统如下图：<br/><br/><span><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/dcfb788be594ad23c9fc7afb.jpg" small="0" class="blogimg"/></span><br/>
（图来自http://www.dzsc.com/data/html/2008-12-16/75269.html）<br/><br/>
其实就这样两个图，比有些地方直接给出的算式容易理解得多。<br/>
而且有些地方还是直接很陡地给出实数计算方法，<br/>
让第一次看这个算法的人反映不过来。<br/><br/><font color="#0000ff">第一个猫腻：</font><br/><br/>
大部分人会就此停止。<br/><font color="#ff0000">（原理都清楚了，实现上有什么问题吗？）</font><br/>
但我看到的三份材料都没有指出一个细节问题：<br/><font color="#ff0000">即计算结果和真正DFT的差异问题。</font><br/><br/>
其中两份是完全没有提到。<br/>
维库的那篇则是想办法规避掉了。<br/><br/>
仔细看上面一阶系统下面的计算过程。<br/>
你会发现先输入的是x[3]在x[2]。。。<br/>
实际上我们的序列是x[0],x[1],x[2]这样过去的。<br/>
如果在每一帧中从后向前输入，<br/>
意即要进行存储，便失去了该算法的第二条意义。<br/><br/>
那么从x[0]开始输入得到的结果是什么呢？<br/>
把式子写出来就会发现，实际上和DFT的定义式是有出入的。<br/>
但我看到的大部分地方就直接当DFT上 那个频点的值使用了。<br/><br/>
通过推导可以得到像上面系统输出的y[n]实际上是这样的一个东西<br/>
y = conj(X[k]) * exp(j * 2 * pi / N * k)          （1）<br/><br/>
通过下面的程序验证：<br/><br/><font color="#ff9900">clear ;<br/>
clc ;<br/><br/>
N = 10 ; %points per frame<br/>
k = 4 ; %the frequency to caculate<br/>
x = rand(1 , N) ; %randomize a series<br/><br/>
X = fft(x) ;<br/>
Xd = X(k + 1) %result from ordinary DFT<br/><br/>
Wk = exp(-j * 2 * pi / N * k) ;<br/>
Xg = 0 ;<br/>
for ii = 1:N<br/>
Xg = Wk * Xg + x(ii) ;<br/>
end<br/>
Xg %result from most derivations of goertzel<br/>
Xg = conj(Xg * Wk) %corrected result of goertzel</font><br/><br/>
输出：<br/><br/>
Xd =<br/>
-0.5698 + 0.0650i<br/>
Xg =<br/>
0.4992 - 0.2823i<br/>
Xg =<br/>
-0.5698 + 0.0650i<br/><br/>
第一个Xg 就是那个系统输出的结果，<br/>
第二个Xg 是根据关系式（1）调整过后的结果。<br/>
可以看到，后面这个才是真正的DFT值。<br/><br/>
那为什么大家都不提这个猫腻呢。。。？<br/>
我觉得主要原因是在应用中，关心的是幅度问题。<br/>
观察（1）式，实际上乘旋转因子和取共轭都是不影响幅度的。<br/>
但是不管怎么说，指出有这个差异，<br/>
交给读者去推导也是行的。<br/>
不能只字不提，让人以为是对的，<br/>
却推很久推不通。。<br/><br/><font color="#0000ff">实系数计算法：<br/><br/></font>这是来自某篇paper的截图，<br/>
要注意他这里用的旋转因子和我们平常定义的不一样，<br/>
指数部分刚好是相反数。<br/><span><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/902133db00794657d1164efb.jpg" small="0" class="blogimg"/></span><br/>
那个式子看起来复杂，实际上可以这样来看：<br/>
先写出y[n] = WNk * y[n-1] + x[n]对应的一阶系统z域描述，<br/>
再把分子分母同时乘一个分母的共轭（乘共轭是常用的实化手段）<br/><br/>
分母被实化了之后，整个递推过程就可以做到实数乘法。<br/>
但递推完了之后，需要一步的复数计算。<br/>
要知道这点，看一下系统的框图就知道了。<br/><span><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/d217f6033ac1c2b9d53f7cfb.jpg" small="0" class="blogimg"/></span><br/>
其实这篇paper把这些写出来还是不错的，<br/>
至少比有些地方直接给出结论容易接受多了。<br/>
不过悲剧的是他仍然写错了一个符号。<br/>
我怀疑他的WNk的定义是为了标新立异，<br/>
结果到后面自己把自己搞囧起了。<br/><br/>
我一开始也有个疑问，就是分母实化后，<br/>
分子仍然是个复数，怎么可能做到实数计算呢？<br/><br/>
但巧妙的就在这个地方，<br/>
因为我们不关心中间的y[n-1],y[n-2]等等，<br/>
只关心y[n]。<br/>
而y[n] 只和w[n] , w[n-1]相关。<br/>
又计算w[n]的部分是纯实数的，<br/>
于是可以先通过N步的实数递推<br/>
得到w[n]和w[n-1]，<br/>
然后通过一步的复数计算得到y[n]。<br/><br/>
验证程序如下：（接在上面的程序后面）<br/><br/><font color="#ff9900">cosk = 2 * cos(2 * pi / N * k) ;<br/>
reg1 = 0 ;<br/>
reg2 = 0 ;<br/>
reg0 = 0 ;<br/>
for ii = 1:N<br/>
reg0 = x(ii) + cosk * reg1 - reg2 ;<br/>
if ii == N<br/>
break ;<br/>
end<br/>
reg2 = reg1 ;<br/>
reg1 = reg0 ;<br/>
end<br/><br/>
Xg2 = reg0 - exp(j * 2 * pi / N * k) * reg1 <br/>
Xg2 = conj(Xg2 * Wk)</font><br/><br/>
这里用到了三个寄存器。<br/>
循环中那个break相当重要，要不reg1的值就被覆盖了。。<br/>
我开始就没注意到这点，发现结果一直对不上。<br/><br/>
结果：<br/><br/>
Xg2 =<br/>
0.4992 - 0.2823i<br/>
Xg2 =<br/>
-0.5698 + 0.0650i<br/><br/>
与之前的数据对比，知道是正确的。<br/>
同时也是需要根据（1）式做相应的调整，才是DFT的值。<br/><br/><font color="#0000ff">第二个猫腻：</font><br/><br/>
看到有地方提<font color="#ff00ff">Goertzel优化算法</font>。<br/><br/>
结果仔细一看，并没啥本质的效率改进。<br/>
递推过程是必然进行的。<br/>
仅仅是在最后从中间结果w[n]和w[n-1]直接推的y[n]的幅度的表达式而已。<br/>
而一帧的计算量已经远远大于最后这一点点计算，<br/>
连常数级的改进都算不上，怎么能说优化呢。<br/><br/></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/backup-hplonline/blog/2009/12/31/nerd%E7%9A%84%E7%AE%80%E6%98%93%E5%88%B6%E8%B0%B1%E6%A0%BC%E5%BC%8F%EF%BC%88%E5%9B%9B%EF%BC%89%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA%E5%8F%8A%E5%90%8E%E8%AE%B0/">Nerd的简易制谱格式（四）效果演示及后记</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-31T14:59:00+08:00" pubdate data-updated="true">Dec 31<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>(hplonline)2009.12.31<br/><br/>
光说不练自然是不行的。<br/>
那么给个demo出来。<br/><br/>
下面是谱<br/>
==========================》<br/><br/>
% 欢乐颂,hplonline,2009/12/30<br/>
T=0.6 % 设定元音符<br/><br/>
3 3 4 5 5 4 3 2 1 1 2 3 3,1.5 2,0.5 2,2<br/>
3 3 4 5 5 4 3 2 1 1 2 3 2,1.5 1,0.5 1,2<br/>
2 2 3 1 2 3,0.5 4,0.5 3 1 <br/>
2 3,0.5 4,0.5 3 2 1 2 L5,2<br/>
3 3 4 5 5 4 3 2 1 1 2 3 2,1.5 1,0.5 1,4<br/><br/>
=====================》<br/><br/>
下面是生成的wav转的mp3。<br/><embed height="390" width="450" pluginspage="http://www.macromedia.com/go/getflashplayer" src="http://www.tudou.com/v/nipQc3cgD7k" wmode="window" play="true" loop="false" menu="false"/><br/><br/><br/><font color="#0000ff">后记：</font><br/><br/>
反正我要的功能达到了，能用就行。<br/>
粗糙一点，但是完全不影响对主干的理解。<br/>
并且至少我用这个格式比用其他打谱软件要快。<br/><br/>
写程序的过程中也出了点插曲。<br/>
比如，网上搜到的一个音阶频率表：<br/><br/>
% L1 131 L2 147 L3 165 L4 175 L5 196 L6 220 L7 247 <br/>
% N1 262 N2 296 N3 330 N4 349 N5 392 N6 440 N7 494 <br/>
% H1 523 H2 587 H3 659 H4 698 H5 784 H6 880 H7 988 <br/>
% I1 1047 I2 1175 I3 1319 I4 1397<br/><br/>
要把他写成matlab数组形式，<br/>
那么中间的如L1,H4之类的就要去掉。。<br/>
我刚想手动操作，<br/>
突然想起学了正则就没怎么用过。。<br/>
于是来了个：<br/>
[LNHI]\d<br/>
这就搞定了。。。<br/><br/>
有的时候学东西就是，<br/>
图个新鲜，并不是为了实用。<br/>
一旦学完就弃之不顾。<br/>
这样真的没啥意思。。<br/><br/>
这个玩意算是我第四次先想好了要干什么，<br/>
再写的程序。。<br/><br/>
大部分时间，都是乱学一通，<br/>
先把相应的功能学得差不多了，<br/>
突然想到，哇，我可以写个程序来干XXX事。<br/>
关键问题就是，为啥一定要干XXX事?<br/><br/>
搞学术的人大可不必顾及这点，<br/>
先把屁放出来，现在没人闻，以后总有人的。<br/>
搞工程可就不行了，<br/>
还是得先来需求，再动手。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/backup-hplonline/blog/2009/12/31/nerd%E7%9A%84%E7%AE%80%E6%98%93%E5%88%B6%E8%B0%B1%E6%A0%BC%E5%BC%8F%EF%BC%88%E4%B8%89%EF%BC%89%E8%A7%A3%E6%9E%90%E7%A8%8B%E5%BA%8F/">Nerd的简易制谱格式（三）解析程序</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-31T14:46:00+08:00" pubdate data-updated="true">Dec 31<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>(hplonline)2009.12.31</p>


<p>即前面下载包中的composer.m。</p>


<p>根据文件格式描述，做这样一个程序相当于一个模拟题。</p>


<p>出于简化，并不对音乐文件进行验证，假设是完全正确的。</p>


<p>从mymusic.m生成result.wav，并且播放。</p>


<p>function main</p>


<p>clear ;<br/>
clc ;<br/>
close all ;</p>


<p>% L1 131 L2 147 L3 165 L4 175 L5 196 L6 220 L7 247 <br/>
% N1 262 N2 296 N3 330 N4 349 N5 392 N6 440 N7 494 <br/>
% H1 523 H2 587 H3 659 H4 698 H5 784 H6 880 H7 988 <br/>
% I1 1047 I2 1175 I3 1319 I4 1397 I5 1568 I6 1760 I7 1976</p>


<p>fid = fopen(&#8216;mymusic.m&#8217;) ;</p>


<p>fs = 44100 ; %采样率<br/>
T=0.5 ; %默认元音符长度<br/>
U=1 ; %默认单位音符长度<br/>
S=2 ; %默认当前音阶</p>


<p>w = [] ; %声音序列</p>


<p>while 1<br/>
     s = fscanf(fid , &#8216;%s&#8217; , [1 , 1]) ;<br/>
     if ~isempty(s)<br/>
         disp(s) ;<br/>
         <br/>
         switch s(1)<br/>
             case &#8216;%&#8217;<br/>
                 fgets(fid) ;%comment is behind the token &#8216;%&#8217;<br/>
                 continue ; <br/>
             case &#8216;T&#8217;<br/>
                 T = sscanf(s(3:end) , &#8216;%f&#8217; , [1 , 1]) ;<br/>
                 continue ;<br/>
             case &#8216;S&#8217;<br/>
                 S = get_index(s(3)) ;<br/>
                 continue ;<br/>
             case &#8216;U&#8217;<br/>
                 U = sscanf(s(3:end) , &#8216;%f&#8217; , [1 , 1]) ;<br/>
                 continue ;<br/>
         end<br/>
         <br/>
         step = get_index(s(1)) ;<br/>
         if isempty(step)<br/>
             step = S ;<br/>
         else <br/>
             s = s(2:end) ;<br/>
         end<br/>
         <br/>
         if s(1) == &#8216;D&#8217; <br/>
             flag = 1 ;<br/>
             s = s(2:end) ;<br/>
         else <br/>
             flag = 0 ;<br/>
         end<br/>
         <br/>
         if sum(s == &#8216;,&#8217;)<br/>
             [rev , ren] = sscanf(s , &#8216;%f,%f&#8217; , [1 , 2]) ;<br/>
             note = rev(1) ;<br/>
             times = rev(2) ;<br/>
         else <br/>
             note = sscanf(s , &#8216;%f&#8217; , [1 , 1]) ;<br/>
             times = 1 ;<br/>
         end<br/>
         <br/>
         length = T * U * times ;<br/>
         if flag<br/>
             freq = note ;<br/>
         else<br/>
             freq = get_freq(step , note) ;<br/>
         end<br/>
         <br/>
         re = get_series(freq ,length , fs) ;<br/>
         <br/>
         w = [w , re] ;<br/>
     else <br/>
         break ;<br/>
     end<br/>
end<br/>
fclose(fid)</p>


<p>wavplay(w , fs) ;<br/>
wavwrite(w , fs , 8 , &#8216;result.wav&#8217;) ;</p>


<p>return ;</p>


<p>function freq = get_freq(step , note)<br/>
     f = [<br/>
         131 147 165 175 196 220 247 <br/>
         262 296 330 349 392 440 494 <br/>
         523 587 659 698 784 880 988 <br/>
         1047 1175 1319 1397 1568 1760 1976 <br/>
     ] ;<br/>
     if note == 0 <br/>
         freq = 0 ;<br/>
     else <br/>
         if isempty(step) || (note &lt; 1) || (note &gt; 7)<br/>
             freq = 0 ;<br/>
         else<br/>
             freq = f(step , note) ;<br/>
         end<br/>
     end<br/>
return ;</p>


<p>function index = get_index(c)<br/>
     a = &#8216;LNHI&#8217; ;<br/>
     index = find(a == c) ;<br/>
return ;</p>


<p>function re = get_series(frequency , length , fs)<br/>
     vac_len = 0.05 ;<br/>
     N = fix(length / (1 / fs)) ;<br/>
     t = (0:N-1) / fs ;<br/>
     re = sin(2 * pi * frequency * t) ;<br/>
     re((N - fix(N * vac_len) + 1):N) = 0 ;<br/>
return ;</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/backup-hplonline/blog/2009/12/31/nerd%E7%9A%84%E7%AE%80%E6%98%93%E5%88%B6%E8%B0%B1%E6%A0%BC%E5%BC%8F%EF%BC%88%E4%BA%8C%EF%BC%89%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%AF%B4%E6%98%8E/">Nerd的简易制谱格式（二）文件格式说明</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-31T14:43:00+08:00" pubdate data-updated="true">Dec 31<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>(hplonline)2009.12.30<br/><br/><font color="#0000ff">mymusic.m :</font><br/>
输入文件名，<br/>
m可以当作是music的意思，<br/>
不过后面还有更恰当的解释<br/><br/><font color="#0000ff">此格式的目的：</font><br/>
高效地主谱录入，以及验证。<br/>
不提供纠错功能，自行对照格式说明排查。<br/>
不是给专业人士使用，<br/>
也不是用来生成可以供人欣赏的音乐。<br/>
作为nerd和geek节约时间的工具，<br/>
或者说仅仅是我自己近期将使用的格式。<br/><br/>
但是我尽量让我的格式简洁，<br/>
即使一个普通人都可以理解此格式。<br/>
而不像专业制谱的时候，<br/>
光是休止符，还得分个4分8分16分之类的。<br/>
同时，此格式提供足够的灵活性，<br/>
只要你想，弄个3.1415926拍长的音出来也完全没有问题。<br/>
而且你可以指定你需要的频率，<br/>
而不是局限在老师教你的那些规整的音上面。<br/>
虽然我不提供各种反复和跳转记号，<br/>
但完全不影响使用。<br/>
由于这个文件是纯文本的，<br/>
把对着需要的段子ctrl+c,ctrl+v就可以了。<br/>
根本不用像在一个软件里面找个功能那么麻烦。<br/><br/><font color="#0000ff">注释方法：</font><br/>
% ，表示将该行后面的内容均注释掉<br/>
注意后面至少有一个空格。<br/><br/><font color="#ff9900">为什么要用这个注释呢。。｛<br/><br/>
一方面是因为最近用matlab比较多，<br/>
第而个是matlab的editor确实不错，<br/>
ctrl+r,ctrl+t来控制注释很方便。<br/>
这样可以使用matlab的editor来编辑我这种音乐格式，<br/>
调试起来应该很方便。<br/><br/>
另外由于要m文件，editor才会接受这个快捷键，<br/>
所以说存成.m而已啦。。其实都是纯文本的。<br/>
用notepad一样可以搞定。。<br/><br/>
｝</font><br/><br/><font color="#0000ff">音符标号：</font><br/>
1,2,3,4,5,6,7分别表示7个音<br/>
0表示休止符<br/>
Dn，其中n为一个实数，表示一个自定义的，频率为n的音<br/><br/></p>

<h1>表示升调，b表示降调，目前不准备提供这个支持。<br/></h1>

<p>因为简谱中很少用到升降，即使用到了，<br/>
可以使用Dn方式自行解决。<br/><br/>
音阶标号：<br/>
L,N,H,I，从低到高，N为普通阶，N1即中央C<br/>
当前默认为N阶<br/><br/>
音长标号：<br/>
使用实数，如0.5、3、4、11等，表示单位音长的倍数，<br/><br/>
元音长：<br/>
T=0.6，表示0.6秒为元音长，在文件开头设定一次。<br/>
默认为0.5。<br/><br/>
单位音长：<br/>
U=实数，表示一个单位音持续的时间为T的倍数。<br/>
在需要的时候重新设定。<br/>
默认为1。<br/><br/><font color="#ff9900">关于单位音长和元音长设定的注解<br/>
｛<br/><br/>
元音长具有全局意义，一处改动将导致整首歌的快慢变化。<br/>
单位音长的意义是增量式的，作用范围在设定之后。<br/>
这样当有连续几个音节奏相同的时候，可以省去省去重复的音长标号。<br/><br/>
元音长一般取得较短，这样单位音长的设定更有灵活性。<br/><br/>
｝</font><br/><br/><font color="#0000ff">当前音阶设定：</font><br/>
S={L|N|H|I}<br/><br/>
单音指定范式：<br/>
[音阶标号]&lt;音符标号&gt;[,&lt;音长标号&gt;]<br/>
音阶标号省去，即为当前音阶。<br/>
音长标号省去，即为单位音长。<br/>
中间是英文状态的逗号。<br/><br/><font color="#ff9900">关于范式的注解<br/>
｛<br/><br/>
这个格式是为快速编辑所设定。<br/>
一般来说，连续的若干个音可以具有相同的长度，<br/>
比如后面示例中的这个歌，依然富含信息量。<br/>
但若连续的若干的音具有相同的音调，和不同的长度，<br/>
则一般是不会出现这种情况的。。<br/>
（否则干嘛不去打鼓。。。。）<br/>
即使出现后，往往也是音调和长度都相同的几个音。<br/><br/>
所以为使录入得到简化，我仅将音符标号作为必要元素。<br/>
而音长和音阶都可以使用一个具有“当前”意义的值。<br/>
只需要在极复杂的情况下带上音阶和标号，<br/>
变化较小时直接修改当前值即可。<br/><br/>
｝</font><br/><br/><font color="#0000ff">文件排版规范：</font><br/><br/>
不拘泥于一般制谱的“小节”概念，<br/>
也不使用“切分”和“连音”的方式。<br/>
仅需要给出音高和长度等信息即可，<br/>
详细情况见《单音指定范式》。<br/><br/>
各语法单元使用空白符分割，<br/>
即空格，TAB，回车，等，可随意书写。<br/>
但是必须的，即使 % 的注释后也不可直接跟内容，<br/>
至少一个空格。%也不能直接跟到上一个单元的结尾。<br/>
即使这样，还是建议用换行分割有意义的单元，<br/>
以及使用注释等来划分更大的区块。<br/><br/><font color="#0000ff">范例：</font><br/><br/>
% 欢乐颂,hplonline,2009/12/30<br/>
T=0.6 % 设定元音符<br/><br/>
3 3 4 5 5 4 3 2 1 1 2 3 3,1.5 2,0.5 2,2<br/>
3 3 4 5 5 4 3 2 1 1 2 3 2,1.5 1,0.5 1,2<br/>
2 2 3 1 2 3,0.5 4,0.5 3 1 <br/>
2 3,0.5 4,0.5 3 2 1 2 L5,2<br/>
3 3 4 5 5 4 3 2 1 1 2 3 2,1.5 1,0.5 1,4</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/backup-hplonline/blog/2009/12/31/nerd%E7%9A%84%E7%AE%80%E6%98%93%E5%88%B6%E8%B0%B1%E6%A0%BC%E5%BC%8F%EF%BC%88%E4%B8%80%EF%BC%89%E7%BC%98%E7%94%B1%E5%8F%8A%E7%A8%8B%E5%BA%8F%E5%92%8C%E7%A4%BA%E4%BE%8B%E4%B8%8B%E8%BD%BD/">Nerd的简易制谱格式（一）缘由及程序和示例下载</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-31T14:42:00+08:00" pubdate data-updated="true">Dec 31<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>(hplonline)2009.12.31<br/><br/><a href="http://www.box.net/shared/l6ofcpyhn6" target="_blank">下载链接</a>，<br/>
包含文件格式说明，<br/>
MATLAB解析程序，<br/>
一个音乐示例mymusic.m，<br/>
另外附上一份音阶频率表。<br/><br/>
供他人有更好的思路时使用。<br/><br/><font color="#0000ff">为什么要做这个东西？</font><br/><br/>
和<a href="http://hi.baidu.com/hplonline/blog/item/a8f8c2fc44c5f1f6fd037f64.html" target="_blank">昨天</a>打的那个谱实在是太有关系了。<br/>
虽然用overture也能够做，总觉得比较麻烦。<br/>
比如，画了个四分音符，马上画八分音符就得在工具栏去选一下。<br/>
（貌似有快捷键，不过没去搜，搜了也记不住，<br/>
毕竟不常用这个东西。。）<br/><br/>
当时的那个谱，我看了前后点了大约40min才搞定。<br/>
这对于一个程序员来说是不能忍受的。。<br/>
（而且还只打了一部分）<br/><br/>
另外一些记号，像冒号双竖线的重复等，<br/>
反正短时间内也找不到怎么弄进去。<br/>
前后有小节比较相似的时候，<br/>
想复制一下，却没找到方法。。<br/><br/>
也许弄一份也就忍了，<br/>
但是接连收到好几份，<br/>
只能想点办法节约点时间。。<br/><font color="#0000ff"><br/>
为什么要用纯文本？</font><br/><br/>
最近围观了鸟哥的著作，<br/>
实际体验了下linux，<br/>
发现纯文本是一种强大的格式。<br/>
其易编辑，易携带，易扩展。<br/>
唯一的一点缺陷就是占空间大、解析耗时。<br/>
但在现在的硬件条件下，这点东西算啥啊。。<br/>
就像我这个用MATLAB写的，一样马上跑出来。<br/><br/><font color="#0000ff">我要达到什么效果？</font><br/><br/>
只要能听懂就行了。。<br/>
我需要的是快速地知道这是什么东西，<br/>
而不是欣赏这个东西。<br/>
当我知道歌名之后，就能去搜原著而已。<br/><br/>
所以在解析的时候，<br/>
我全部使用的是单频的sin函数。。<br/><br/><font color="#0000ff">核心思想：</font><br/><br/>
什么调式，拍子，音阶之类的都是狗屁，<br/>
（虽然后面我也会沿用一些术语。。。）<br/>
那些都是人发明出来欺负人的。<br/>
我想之所以有不少同学认为难以学习音乐，<br/>
就是被这样搞晕的。。<br/><br/>
你想啊，一个初学者在五线谱上数#和b的个数，<br/>
然后老师告诉他，记住，这是XX调。<br/>
然后XX调的do、re……又是某某键。<br/>
XX调的do又是从哪根线开始的。<br/><br/>
等到该停顿的时候，<br/>
还得分各种长相，<br/>
才知道是几分休止符。<br/><br/>
等一个人刚刚把基本节奏学会了，<br/>
马上又有3连音，5连音之类的非主流架构。。<br/><br/>
即便是如此复杂的体系，其表现力低得惊人。。<br/>
比如：<br/>
请帮我记录这样的一个音符，3.1415926拍，在mi和fa之间。<br/><br/>
先说节奏问题，就从来没发明过足够表达的记法。<br/>
再说音阶问题，mi和fa之间本来就是半阶，已经是最小的单位。。<br/><br/><font color="#0000ff">而我认为：</font><br/><br/>
一个音只有三个元素：频率，长度，幅度<br/><br/>
注意没有引入中学物理上说的所谓音色。<br/>
因为音色强调的是主音附近的泛音问题，<br/>
实质上是有杂糅的频率成分在里面。<br/><br/>
而幅度的问题，则可以直接取为一个单位。<br/>
因为我仅仅是对一首曲子的主干进行刻画，<br/>
没必要忽大忽小的。<br/>
即便是要这样，我扩展一下这个格式就行了。<br/><br/>
这样下来，我只需要两个元素来刻画一个音：<br/>
频率，长度。<br/><br/>
比如，我可以这样写<br/><br/>
D340,3.1415926<br/>
就可以搞定我上面提出的那个尴尬问题了。<br/><br/>
而为了使得录入简化，<br/>
需要定义一些默认值。<br/>
这些就留在后面的文件格式说明中集中来谈了。<br/><br/>
最后的一首曲谱可能长成这样：<br/><br/><font color="#ff9900">% 欢乐颂,hplonline,2009/12/30<br/>
T=0.6 % 设定元音符<br/><br/>
3 3 4 5 5 4 3 2 1 1 2 3 3,1.5 2,0.5 2,2<br/>
3 3 4 5 5 4 3 2 1 1 2 3 2,1.5 1,0.5 1,2<br/>
2 2 3 1 2 3,0.5 4,0.5 3 1 <br/>
2 3,0.5 4,0.5 3 2 1 2 L5<br/>
3 3 4 5 5 4 3 2 1 1 2 3 2,1.5 1,0.5 1,4 <br/></font><br/><br/></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/backup-hplonline/blog/page/8/">&larr; Older</a>
    
    <a href="/backup-hplonline/blog/archives">Blog Archives</a>
    
    <a class="next" href="/backup-hplonline/blog/page/6/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/backup-hplonline/blog/2013/05/04/test/">Test</a>
      </li>
    
      <li class="post">
        <a href="/backup-hplonline/blog/2011/04/09/%E5%86%8D%E8%B0%88stl%E7%9A%84rotate/">再谈stl的rotate</a>
      </li>
    
      <li class="post">
        <a href="/backup-hplonline/blog/2011/02/01/%5Bpaper%5DXORsinTheAir%3APracticalWirelessNetworkCoding%EF%BC%88%E7%BF%BB%E8%AF%91%E3%80%81%E4%BA%8C%EF%BC%89/">[paper] XORs in The Air: Practical Wireless Network Coding（翻译、二）</a>
      </li>
    
      <li class="post">
        <a href="/backup-hplonline/blog/2011/02/01/%5Bpaper%5DXORsinTheAir%3APracticalWirelessNetworkCoding%EF%BC%88%E7%BF%BB%E8%AF%91%E3%80%81%E4%B8%89%EF%BC%89/">[paper] XORs in The Air: Practical Wireless Network Coding（翻译、三）</a>
      </li>
    
      <li class="post">
        <a href="/backup-hplonline/blog/2011/02/01/%5Bpaper%5DXORsinTheAir%3APracticalWirelessNetworkCoding%EF%BC%88%E7%BF%BB%E8%AF%91%E3%80%81%E4%B8%80%EF%BC%89/">[paper] XORs in The Air: Practical Wireless Network Coding（翻译、一）</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - hplonline -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
