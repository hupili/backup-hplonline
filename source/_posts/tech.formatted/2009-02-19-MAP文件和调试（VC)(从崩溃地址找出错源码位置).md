---
layout: post
title: "MAP文件和调试（VC)(从崩溃地址找出错源码位置)"
date: 2009-02-19  21:55
comments: true
categories: tech
tags: ["Vc"]
_baiduhi_id: 16e2223804750723b9998f53.html
_baiduhi_category: Vc
---

也是：一直听说，从未动手。<br/><br/>
所以，用VC生成一下MAP文件，帮助调试。<br/><font color="#0000ff"><br/></font><font color="#0000ff">一.步骤:</font><br/><br/><span style="font-size: 12pt; ">Project Settings</span><span style="font-size: 12pt; ">-&gt;</span>
 
 
 
 
 
 
 
 
 
 <span style="font-size: 12pt; ">C/C++-&gt;</span>
 
 
 
 
 <span style="font-size: 12pt; ">Project Options</span>:<br/>
这里输入
 
 
 
 
 <span style="font-size: 12pt; ">/Zd</span>，将在编译时生成行信息。<br/><br/><span style="font-size: 12pt; ">Project Settings</span><span style="font-size: 12pt; ">-&gt;Link-&gt;</span>
 
 
 
 
 
 
 
 
 
 <span style="font-size: 12pt; ">Project Options</span>:<span style="font-size: 12pt; "><br/>
/mapinfo:lines</span><br/><span style="font-size: 12pt; ">/map:<font color="#333399">MapFileName</font>.map</span><br/><span style="font-size: 12pt; ">/mapinfo:exports</span><br/><br/><span style="font-size: 12pt; ">MapFileName是生成MAP文件的名字<br/>
第一个是生成行信息，第三个是加入导出信息。<br/><br/>
这样就设置好了,编译出来的就有MAP文件了.<br/><br/><font color="#0000ff">二.MAP文件:</font><br/>
写一个程序,编译出来:<br/><br/>
#include &lt;stdio.h&gt;<br/><br/>
int main(){<br/>
     int i = 2;<br/>
     int j ;<br/>
     scanf("%d",&amp;j);<br/>
     i = 2;<br/>
     i = 3;<br/>
     i = 4;<br/>
     i = 5;<br/>
     i = 6;<br/>
     printf("%d",i/j);<br/>
     return 0 ;<br/>
}<br/><br/>
然后打开MAP文件.<br/>
里面有各种全局符号,大概在文件的中间位置,有这样的东西:<br/>
Line numbers for .\Debug\4.obj(E:\pro\4\4.cpp) segment .text<br/><br/>
      3 0001:00000010      4 0001:00000024      6 0001:0000002b      7 0001:0000003c<br/>
      8 0001:00000043      9 0001:0000004a     10 0001:00000051     11 0001:00000058<br/><br/>
可以直接Ctrl+F找到程序文件名，我这里是4.cpp<br/>
这些就是代码偏移和对应的行号.<br/><br/><font color="#0000ff">三.调试</font><br/><br/>
就刚才的程序，运行，输个0，过一下出错框就来了，<br/>
我是VISTA，下面的详细信息是：<br/>
问题签名:<br/>
  问题事件名称:     APPCRASH<br/>
  应用程序名:     4.exe<br/>
  应用程序版本:     0.0.0.0<br/>
  应用程序时间戳:     499d5ade<br/>
  故障模块名称:     4.exe<br/>
  故障模块版本:     0.0.0.0<br/>
  故障模块时间戳:     499d5ade<br/>
  异常代码:     c0000094<br/><font color="#ff0000">异常偏移量:     00001063</font><br/>
  OS 版本:     6.0.6001.2.1.0.768.3<br/>
  区域设置 ID:     2052<br/>
  其他信息 1:     38fc<br/>
  其他信息 2:     db4f9c1c160faa4608f429ddffa01d6f<br/>
  其他信息 3:     cb3b<br/>
  其他信息 4:     e8ffb2a21d4a9ed7b258f1866c9d3db8<br/><br/>
这个偏移就是要看的了。减去1000的代码段偏移。<br/>
就是63，再对照上面的行号和地址的列表<br/></span><span style="font-size: 12pt; ">11 0001:00000058<br/>
这个是VC翻译的时候，第11行显然会对应多条指令。<br/>
这一指令群的开始地址是58.<br/>
这个是最接近63且比63小的地址，所以问题应该出在这一行上。<br/>
再看代码：<br/></span><span style="font-size: 12pt; ">printf("%d",i/j);<br/>
发现这里有个除0错误。<br/><br/>
OK，记到这里，以后用到了来翻<br/></span>
