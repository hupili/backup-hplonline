---
layout: post
title: "简单的通用花式流水灯"
date: 2009-02-26  19:18
comments: true
categories: tech
tags: ["Scm"]
_baiduhi_id: 1bbfb919050a4a4242a9ada5.html
_baiduhi_category: Scm
---

<div forimg="1">(hplonline)2009.2.26<br/><br/>
虽然是汇编，但是实现得简单，用查表法，可以实现花式显示。<br/>
主要目的是练一下KEIL下的汇编。。<br/><br/><br/>
一。电路<br/><br/>
就这个样子。。好像没啥说的。。旁边那个发光管是因为才用proteus，为了验证确实可以这样点亮放的。。再旁边的一排按键暂时还没用到。<br/><br/><img height="423" width="589" border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/a35ddaa2caf1ab8dcaefd074.jpg" small="0" class="blogimg"/><br/><br/>
二。代码<br/><br/>
org 00h <br/><br/>
mov R0 , #0 <br/>
mov R1 , #count<br/><br/>
main:<br/>
mov A , r0<br/>
mov DPTR , #table <br/>
movc A , @A + DPTR <br/>
mov P1 , A<br/>
call delay<br/>
inc R0<br/>
djnz R1 , main<br/><br/>
mov R0 , #0 <br/>
mov R1 , #count <br/><br/>
ljmp main<br/><br/>
ljmp $<br/><br/>
delay:<br/>
mov R5,#10<br/>
D3:<br/>
mov R7,#100<br/>
D1:<br/>
MOV R6,#200<br/>
D2:<br/>
djnz R6,D2<br/>
djnz R7,D1<br/>
djnz R5,D3<br/>
ret<br/><br/>
table: db 1 , 2 , 4 , 8 , 16 , 32 , 64 , 128  ,0ffh , 00h , 0f0h , 0fh<br/>
count EQU $ - table<br/><br/>
END 　　<br/><br/>
首先，在最后有个table，指示的是灯的显示掩码。<br/>
程序运行开始就查这个表，然后依次按样式显示。<br/>
表长是可以任意更改的，<br/>
因为最后是用count这个编译期常量来指定的，所以加入任意的式样掩码就可以了。<br/><br/>
delay:到ret之间就是一般的延时程序，没啥好说的。<br/>
之所以用了三层，是为了所需时间的伸缩性考虑。<br/><br/>
ljmp $这个就是典型的死循环，就是while(1)的意思，在这个程序里面执行不到这里。<br/>
纯粹是作为习惯打在这个地方的，这样，在指定操作完后，死循环，<br/>
避免程序一直执行到底后复位。<br/><br/>
然后是最前面的部分。<br/><br/>
这里用R1来做循环计数，所以有初值#count</div>
这里又丑陋了一次，不小心写成count了（意思为立即寻址。。）<br/><br/>
R0来做table的下标指示，从0开始递增<br/><br/>
mov DPTR , #table 这条貌似是51里面唯一一条16位指令。<br/>
把地址送到DPTR里面去。<br/>
注意如果#table写成了talbe就戳了。。直接编译错误，<br/>
因为把table的值（在ROM里的位置)按照直接寻址来操作，<br/>
都超过可直接寻址的范围了。<br/><br/>
movc A , @A + DPTR  ， 这条的写法很固定。。。<br/>
相当于查table表，把掩码送到A里面，<br/>
注意是MOVC就是了，MOVC这条指令专门用来查ROM里面的值。<br/><br/>
嗯，顺便，与片外RAM传递要用MOVX<br/><br/>
三。花样<br/><br/>
table: db 1 , 2 , 4 , 8 , 16 , 32 , 64 , 128  ,0ffh , 00h , 0f0h , 0fh<br/><br/>
就改这个表就OK 了。。所以说简单。。<br/><br/>
比方说：<br/>
table: db 1 , 2 , 4 , 8 , 16 , 32 , 64 , 128<br/>
按照我这个电路跑出来就是一个一个地依次灭掉<br/><br/>
table: db 0ffh , 00h , 0f0h , 0fh<br/>
这个跑出来就是全灭，全开，下一半开，上一半开<br/><br/>
。。想怎么改就怎么改。。<br/><br/><br/><br/>
其实我就是拿来练汇编的。。所以实现的功能戳一点。。
