---
layout: post
title: "定时中断闪烁灯"
date: 2009-02-27  22:49
comments: true
categories: tech
tags: ["Scm"]
_baiduhi_id: 0c7f007b13bc7bfc0bd187c2.html
_baiduhi_category: Scm
---

<div forimg="1">(hplonline)2009.2.27<br/><br/>
电路图依然简单，因为这个练习的目标是定时中断<br/><br/><br/><a href="http://hiphotos.baidu.com/hplonline/pic/item/40e5d3f94f81c679242df2d2.jpg" target="_blank">
<div forimg="1"><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/40e5d3f94f81c679242df2d2.jpg" small="0" class="blogimg"/></div>
<br/></a></div>
<font color="#0000ff">代码：</font><br/><br/>
v_th EQU 0d8h<br/>
v_tl EQU 0efh<br/>
count EQU 100;100<br/>
v_tmod EQU 1h<br/><br/>
org 00h<br/>
ljmp main<br/>
org 0bh<br/>
ljmp timer0<br/><br/>
org 30h<br/>
main:<br/>
     mov R0 , #0<br/>
     mov P1 , #0<br/>
     mov TH0 , #v_th<br/>
     mov TL0 , #v_tl<br/>
     mov TMOD , #v_tmod         <br/>
     setb EA<br/>
     setb ET0<br/>
     setb TR0<br/><br/>
sjmp $<br/><br/>
timer0:<br/>
push PSW<br/><br/>
     mov TH0 , #v_th<br/>
     mov TL0 , #v_tl<br/>
     inc R0<br/>
     cjne R0 , #count , next<br/>
     mov R0 , #0<br/>
     cpl P1.0<br/>
     next:<br/>
          <br/>
pop PSW<br/>
reti<br/><br/>
end<br/><br/>
程序结构比较清楚<br/><br/>
v_th EQU 0d8h<br/>
v_tl EQU 0efh<br/>
这两个指定计时次数10000<br/>
count EQU 100;100<br/>
这个指定软计数次数100算下来也就是10^6*1/(10^6) = 1秒一闪<br/>
v_tmod EQU 1h<br/>
这个指定的是工作模式，0号计时器用1号模式，16位计数<br/><br/><font color="#0000ff">总框架是这样的：</font><br/><br/>
org 00h<br/>
ljmp main<br/>
;跳至主函数<br/>
org 0bh<br/>
ljmp timer0<br/>
;跳至0号计时器的中断处理<br/>
org 30h<br/>
main:<br/>
;这里是主函数内容<br/>
sjmp $<br/><br/>
timer0:<br/>
push PSW<br/>
;保护一些现场<br/>
;...中断处理<br/>
;恢复一些现场<br/>
pop PSW<br/>
reti<br/><br/>
end<br/><br/>
好 ，然后是主函数，先个P1赋值开灯，然后给R0赋初值，<br/>
R0是后面软计数用到的计数器。<br/><br/>
接下来设置工作模式，和T0的计时初值。<br/><br/>
最后三个setb，依次是总中断开关，0号计时器允许开关，0号计时器计时开关<br/><br/>
中断处理，每次增加R0，然后比较是否到了软计数次数，<br/>
到了就令软计数器R0回0，然后翻转P1.0，实现灯的闪烁。。<br/><br/><br/>
