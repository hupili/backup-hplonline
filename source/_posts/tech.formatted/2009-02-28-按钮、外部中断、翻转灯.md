---
layout: post
title: "按钮、外部中断、翻转灯"
date: 2009-02-28  18:12
comments: true
categories: tech
tags: ["Scm"]
_baiduhi_id: 83afdc88684f859ca5c27206.html
_baiduhi_category: Scm
---

(hplonline)2009.2.28<br/><br/>
用四个按钮来控制，按一下，翻转相应的灯<br/><br/><font color="#0000ff">一。电路</font><br/><br/><div forimg="1"><img border="0" class="blogimg" small="0" src="http://hiphotos.baidu.com/hplonline/pic/item/2bc327f538493605bd3109a6.jpg"/><br/>
右边为了方便用了总线。<br/>
相当于电源过电阻后接到P1的上面四个口。<br/>
该四口分别过按钮到地。<br/>
这样，常态下，该四口为高电平，按下后为低。<br/>
该四口再“与”到一起，接到INT0上面。<br/>
这样，按下按键后就有中断送入了。<br/><br/><font color="#0000ff">二。程序</font><br/><br/>
org 00h<br/>
ljmp func_main<br/>
org 03h<br/>
ljmp func_xint0<br/><br/>
org 30h<br/>
func_main:<br/><br/>
        setb EA<br/>
        setb EX0<br/><br/>
sjmp $<br/><br/>
func_xint0:<br/>
push PSW<br/><br/>
        jnb P1.7 , _l7<br/>
        jnb P1.6 , _l6<br/>
        jnb P1.5 , _l5<br/>
        jnb P1.4 , _l4<br/><br/>
        _l7:<br/>
        cpl P0.7<br/>
        sjmp _end<br/>
        _l6:<br/>
        cpl P0.6<br/>
        sjmp _end<br/>
        _l5:<br/>
        cpl P0.5  <br/>
        sjmp _end<br/>
        _l4:<br/>
        cpl P0.4<br/>
        _end:<br/>
        acall func_delay<br/>
pop PSW<br/>
reti<br/><br/>
func_delay:<br/>
        mov R5,#10<br/>
        D3:<br/>
        mov R7,#50<br/>
        D1:<br/>
        MOV R6,#200<br/>
        D2:<br/>
        djnz R6,D2<br/>
        djnz R7,D1<br/>
        djnz R5,D3<br/>
ret<br/><br/>
end<br/><br/>
主函数开启中断后就进入死循环了，实际上可以做其他的事情。<br/><br/>
中断处理中，分别判断是哪个键按下了，然后翻转对应的灯。<br/><br/>
中断的最后延迟一段，防止按键抖动。。<br/><br/>
话说。。当时把jnb打成jb了。。查了老半天。。</div>
