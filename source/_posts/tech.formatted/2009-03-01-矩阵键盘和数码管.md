---
layout: post
title: "矩阵键盘和数码管"
date: 2009-03-01  15:21
comments: true
categories: tech
tags: ["Scm"]
_baiduhi_id: 89c8780e2764d3c27acbe1ed.html
_baiduhi_category: Scm
---

<div forimg="1">(hplonline)2009.3.1<br/><br/>
练习矩阵键盘，然后从数码管显示出来，<br/>
为了从简，就2*2的了。。<br/>
从上到下，从左到右的键，编为1..4号。<br/><br/><br/><font color="#0000ff">一。电路</font><br/><br/><a href="http://hiphotos.baidu.com/hplonline/pic/item/c3f104f4113e174edcc47491.jpg" target="_blank">
<div forimg="1"><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/c3f104f4113e174edcc47491.jpg" small="0" class="blogimg"/></div>
<br/></a></div>
我觉得我的形象思维有问题。。<br/>
想了老半天，才把键盘画成这样。。开始一直是看上去一团糟。。<br/>
先按照有个加正电源的方法做了没做出来，然后改成了这种。<br/><br/>
简要的说就是，把含扫描和列扫描线引出排成矩形。之间并不相交。<br/>
每个行扫描线和每个列扫描线之间均通过一个按钮连通。<br/><br/>
这样，扫描按键的时候，<br/>
对行线赋1，列线赋0，再读取行线，<br/>
如果某一行有按键按下，那该行为0.。<br/>
相反，对列线赋1，行线赋0，再读取列线，<br/>
如果某一列有键按下，那该列为0.。<br/>
这样就能定位按下的键了。<br/><br/><br/><font color="#0000ff">二。程序</font><br/><br/>
org 00h<br/>
ljmp func_main<br/><br/>
org 30h<br/>
func_main:<br/>
     <br/>
     mov R2 , #0<br/>
     acall func_getkey<br/>
     cjne R2 , #0 , _show<br/>
     sjmp func_main<br/>
     _show:<br/>
     acall func_show<br/>
     sjmp func_main<br/><br/>
sjmp $<br/><br/>
func_show:<br/>
     cjne R0 , #1h , _nop<br/>
     mov R0 , #0 <br/>
     _nop:<br/>
     mov A , R0<br/>
     add A , R1<br/>
     mov DPTR , #table<br/>
     movc A , @A+DPTR<br/>
     mov P0 , A<br/><br/>
ret<br/><br/>
func_getkey:<br/>
     mov P1 , #03h<br/>
     mov R0 , P1<br/>
     cjne R0 , #03h , _keypressed<br/>
     sjmp _end<br/>
     _keypressed:<br/>
     mov A , R0<br/>
     xrl A , #03h<br/>
     mov R0 , A<br/>
     mov R2 , #1<br/>
     mov P1 , #0ch<br/>
     mov A , P1<br/>
     rr A<br/>
     rr A<br/>
     mov R1 , A<br/>
     _end:<br/>
ret<br/><br/>
table: db 0 , 110b , 1011011b , 1001111b , 1100110b<br/><br/>
end<br/><br/>
这个，我觉得我的抽象思维有点问题。。写了很久。。才把这个简单的问题写通顺。<br/><br/>
main:<br/>
R2用来表示是否有键按下。有 键按下，才重新显示数字。<br/><br/>
show:<br/>
查询table表，以获得字形码。我这个共阴的数码管。<br/><br/>
getkey:<br/>
就是重复原理中叙述的话而已。。。可能有点废话。。<br/><br/>
