---
layout: post
title: "帮人改代码（判断工作簿打开否）（VBA)"
date: 2009-03-07  16:38
comments: true
categories: tech
tags: ["Vb"]
_baiduhi_id: e6dca5c3af61185db219a827.html
_baiduhi_category: Vb
---

(hplonline)2009.3.7<br/><br/>
VBA,除了知道和VB是兄弟外，其实没有专门学过<br/><br/>
但是人家都来问了，像我这么热心的当然要去看一下对吧。<br/><br/>
==============下面是引用<br/><br/>
有人在么<br/><br/>
我在写excel    vba的时候检测工作薄是否打开<br/>
但是总出错阿<br/><br/>
Sub openif()<br/>
Dim bookopenbool As Boolean<br/>
Dim wb As Workbook<br/>
Dim mywb As String<br/>
mywb = "bb.xls"<br/>
Set wb = Workbooks(mywb)<br/>
bookopenbool = Not wb Is Nothing<br/>
If bookopenbool Then<br/>
MsgBox "meiyoudakai"<br/>
End If<br/>
If Not bookopenbool Then<br/>
MsgBox "dakaile"<br/>
End If<br/><br/>
End Sub<br/><br/>
Set wb = Workbooks(mywb)在这一句中<br/><br/>
如果bb.xls没有打开的话<br/>
wb 的值就是nothing<br/><br/>
但这个时候编译器总是报错<br/><br/>
说下届越位<br/><br/>
===========================<br/><br/>
我一看这代码。。雷啊。。。<br/>
下面用两个if ,舍不得用个else<br/><br/>
其实这不是关键。。仔细看他的条件。。当工作簿打开的时候。。<br/>
MsgBox "meiyoudakai"<br/><br/>
不过我也不清楚workbooks这个集合。。<br/>
M$的帮助里面也没见提到，不清楚当不存在时会怎么样。。<br/><br/>
于是想啊想。。。<br/><br/>
最后。。终于发现，其实这个问题很简单。。变相实现就可以了:<br/><br/>
     Dim wb As Workbook<br/>
     Dim mywb As String<br/>
     mywb = "1.xls"<br/>
     On Error GoTo err1<br/>
     Set wb = Workbooks.Item(mywb)<br/>
     MsgBox "opened"<br/>
     Exit Sub<br/>
err1:<br/>
     MsgBox "not opened"<br/><br/>
既然没打开的时候，要报下标越界。。就直接把错误给容掉不就OK了。。。<br/><br/>
汗。。
