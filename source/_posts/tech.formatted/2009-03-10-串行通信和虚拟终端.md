---
layout: post
title: "串行通信和虚拟终端"
date: 2009-03-10  19:11
comments: true
categories: tech
tags: ["Scm"]
_baiduhi_id: 0a3fa76e701548d280cb4aa7.html
_baiduhi_category: Scm
---

(hplonline)2009.3.10<br/><br/>
用用PROTEUS的虚拟终端而已<br/>
顺便用下MAX232这个芯片<br/><br/><font color="#0000ff">一。电路</font><br/><br/><div forimg="1"><img border="0" class="blogimg" small="0" src="http://hiphotos.baidu.com/hplonline/pic/item/733afd03935dbbcd09fa93b9.jpg"/></div>
<br/>
这里的MAX232外部虽然接了这么些电容。。<br/>
其实不接他们也可以运作的。。这就是PROTEUS的强大之处。。<br/>
好比你的单片机也没有接晶振啊啥的。。<br/><br/>
那么。。他们仅仅是个造型？<br/>
这是好事还是坏事呢？<br/><br/><font color="#ff6600">一方面我们可以专注于主要问题<br/>
另一方面，我们忽略细节</font><br/><br/><font color="#0000ff"><br/>
二。程序</font><br/><br/>
ctrl BIT P3.7<br/><br/>
org 00h<br/>
ljmp func_main<br/><br/>
org 30h<br/>
func_main:<br/><br/>
        mov SCON , #01010000b<br/>
        mov TMOD , #20h<br/>
        orl PCON , #10000000b<br/>
        mov TH1 , #0f3h<br/>
        mov TL1 , #0f3h<br/>
        setb TR1<br/>
        again:<br/>
        jnb RI , $<br/>
        clr RI<br/>
        mov A , SBUF <br/>
        mov SBUF , A<br/>
        jnb TI , $<br/>
        clr TI<br/>
        sjmp again<br/><br/>
sjmp $<br/><br/>
end<br/><br/>
就是一个终端输入什么，单片机返回什么。。没啥特别的..<br/><br/>
mov SCON , #01010000b<br/>
设置允许接收,工作方式1,即波特率可变.<br/><br/>
mov TMOD , #20h<br/>
T1按照方式2工作，即自动重置计时<br/><br/>
orl PCON , #10000000b<br/>
PCON的MSB置1，即SMOD为1<br/><br/>
计时器的溢出率 = fosc / 12 * (0xff - 0xf3)<br/><br/>
波特率 = 溢出率 * 2^SMOD / 32<br/><br/>
取fosc = 12M<br/><br/>
算得 波特率为 4807.6923076923076923076923076923<br/><br/>
近似为标准的4800<br/><br/>
只要在虚拟终端处有相应的设置就行了。<br/>
