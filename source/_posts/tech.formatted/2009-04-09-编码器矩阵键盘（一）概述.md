---
layout: post
title: "编码器矩阵键盘（一）概述"
date: 2009-04-09  19:20
comments: true
categories: tech
tags: ["Scm"]
_baiduhi_id: 93ccc5fc8ec8ea8ab801a0b6.html
_baiduhi_category: Scm
---

(hplonline)2009.4.9<br/><br/><font color="#0000ff">动机：<br/></font><br/>
前天数电课上讲了<font color="#ff0000">编码器</font>，突然想到了用编码器来做<font color="#ff0000">矩阵键盘</font>。<br/><br/>
因为学单片机之前，也在其他环境下写过不少程序，所以，<br/>
理解了一个简单的硬件环境之后，用复杂的程序来实现某个功能没多大乐趣。。<br/><br/>
所以我一直喜欢在硬件上搞点花样，当然不少花样也是有价值的，<br/><font color="#ff0000">比如减少IO口的占用数，简化程序的编写</font>等等<br/>
（我这个2*2的矩阵键盘只用了3个口，传统编法要用四个口，<br/>
后面我会总结一下几类键盘）<br/><br/><font color="#ff6600">为了演示的简单性，就只用了2*2的键盘，可以推知4*4的键盘只用四个IO口。8*8的只用5个口。。。。</font><br/><br/>
这个东西，说出来了之后就是一显然的事实，没说出来之前就不见人做。。。<br/>
并且我做的时候，在某些问题上囧了很久，所以迫不及待地要展示两个东西。<br/><br/><font color="#0000ff">成品：</font><br/><br/><div forimg="1"><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/24c0cc5cc89a2b61faf2c0cb.jpg" small="0" class="blogimg"/></div>
先分别介绍四个区，后面的四个部分将专门进行描述：<br/><br/><font color="#ff6600">1.显示部分</font><br/>
下面的是行的值，上面的是列的值，按照从1开始计，没有按键的时候显示的是两个0<br/><br/><font color="#ff6600">2.键盘部分</font><br/>
包括键盘和扫描键盘用的IO口，可以看到占用的口数<br/>
（其中的P1.1是一开始画上的，其实没用到）<br/><br/><font color="#ff6600">3.编码部分</font><br/>
即是把矩阵键盘的行列线编码成要的数值<br/><br/><font color="#ff6600">4.扫描信号部分</font><br/>
用于产生行列扫描信号，在这里因为没有考虑到“冒险”的问题，囧了很久<br/><br/><font color="#0000ff">程序：</font><br/><br/><font color="#ff0000">我相信就这个程序的长度就足以诱惑一个人去细看是怎么实现的。。。</font><br/><br/>
typedef unsigned char uchar ;<br/><br/>
sbit TEST = P1 ^ 3 ;       //测试信号，高为列测试，低为行测试<br/>
sbit KEY_PRESSED = P1 ^ 2 ;     //有按键信号，高有效<br/><br/>
void main(){<br/>
     uchar tmp ;<br/>
     uchar col ;<br/>
     uchar row ;<br/>
     while(1){<br/>
          TEST = 1 ;<br/>
          if ( KEY_PRESSED ) {<br/>
               col = (P1 &amp; 0x01 ) + 1;     //获得列值<br/>
               TEST = 0 ;<br/>
               row = (P1 &amp; 0x01 ) + 1;     //获得行值<br/>
               tmp = ( row &lt;&lt; 4 ) + col ; //产生显示BCD码<br/>
               P2 = tmp ;     //送47，48译码显示<br/>
          }else{<br/>
               P2 = 0x00;//没有键的时候输出 0 0 <br/>
          }<br/>
     };<br/>
}<br/><br/>
不少初学者一开始做的时候，觉得扫描键盘的程序很臃肿。<br/>
这是由外电路的简单性决定的，（貌似地球人的玩法都如出一辙）<br/>
而我已经<font color="#ff0000">尽量将冗余操作放到了外电路上</font>，<br/>
所以程序自然很短。<br/>
