---
layout: post
title: "__based(c++)"
date: 2009-04-13  14:38
comments: true
categories: tech
tags: ["c","c++"]
_baiduhi_id: b8068013d2d60bd8f6039e80.html
_baiduhi_category: c&c++
---

(hplonline)2009.4.13<br/><br/>
发现了这样一个东西，不过感觉很没有应用价值。。。。<br/><br/>
__based用来指定一个相对的指针。<br/>
在__based(x)处的x为基地址。<br/><br/>
看下面这个例子，大家就知道是怎么一回事了。<br/><br/>
int a[10] = {10,20,30,40,50,60,70,80,90,10} ;<br/><br/>
int main(){<br/>
     int* pa = a ;<br/>
     int __based(pa)* p ;<br/>
     p = 0 ;<br/>
     cout&lt;&lt;*p&lt;&lt;endl;<br/>
     p += 3; <br/>
     cout&lt;&lt;*p&lt;&lt;endl;<br/>
     return 0 ;<br/>
}<br/><br/>
我在VC6上试的时候，p只能赋0，不能赋其他的值<br/>
算术运算也只支持+=,-=,++,--这些，乘除也是不可以的。<br/><br/>
而且脱指针引用(dereference)的时候，依然是把这个偏移加上基址来的。<br/>
如下：<br/><br/>
mov      dword ptr [ebp-4], offset a ;[ebp - 4]是pa<br/>
xor      eax, eax<br/>
mov      dword ptr [ebp-8], eax;[ebp - 8]是p , p = 0 <br/>
push     004010C8;endl<br/>
mov      ecx, dword ptr [ebp-8]<br/>
add      ecx, dword ptr [ebp-4]<br/>
mov      edx, dword ptr [ecx];edx = pa + p<br/>
push     edx<br/>
mov      ecx, offset std::cout;__thiscall，类的地址放ecx中<br/>
call     004010FF;operator&lt;&lt;<br/>
mov      ecx, eax;eax返回的是cout的引用，放入ecx，达到&lt;&lt;的级联使用<br/>
call     004011E0;operator&lt;&lt;<br/><br/><img src="http://img.baidu.com/hi/tsj/t_0009.gif"/>又没效率上的优势，功能也有限制。。那我们发明他干嘛呢。<br/>
求高手解。<br/>
