---
layout: post
title: "VB导入空格分割的数据到EXCEL"
date: 2009-05-09  22:08
comments: true
categories: tech
tags: ["Vb"]
_baiduhi_id: b605c41b489a55f2ae51331b.html
_baiduhi_category: Vb
---

(hplonline)2009.5.9<br/><br/><a href="http://www.box.net/shared/cpfedv5zim" target="_blank">成品下载</a><br/><br/><font color="#0000ff">起因：</font><br/><br/>
本来是在做数据分析的，在MATLAB里面整了个相关系数矩阵。<br/><br/>
就像这种形状：<br/><br/>
ca =<br/><br/>
       1.0000       0.9345       0.9655       0.9977      -0.8814       0.9839<br/>
       0.9345       1.0000       0.9940       0.9442      -0.9655       0.9761<br/>
       0.9655       0.9940       1.0000       0.9718      -0.9562       0.9901<br/>
       0.9977       0.9442       0.9718       1.0000      -0.9062       0.9887<br/>
      -0.8814      -0.9655      -0.9562      -0.9062       1.0000      -0.9328<br/>
       0.9839       0.9761       0.9901       0.9887      -0.9328       1.0000<br/><br/>
结果直接复制粘贴到EXCEL里面就<font color="#ff0000">全部在一列</font>里面了。。很囧。<br/>
前面几次的变通解决是先存个TXT，然后用EXCEL“数据”菜单下的“导入”功能。<br/><br/>
这回貌似会比较频繁地出现这种操作。。所以想找个更易操作的方法。<br/>
VB里面调用EXCEL还是比较方便。<br/>
特别对我这种不求甚解的人来，很快可以上手开始用。<br/><br/><font color="#0000ff">效果：</font><br/><br/><div forimg="1"><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/1f1e11d5614224e750da4b5e.jpg" small="0" class="blogimg"/></div>
<br/>
row和col指定数据开始的单元格坐标。<br/>
下面的多行文本框就就是要导入的数据，<br/>
所谓空格可以是：空格，TAB，回车，换行<br/>
并且遇到回车的时候可以从下一行开始写EXCEL。<br/>
点convert可以开始转移数据。<br/><br/><font color="#0000ff">界面设置：</font><br/><br/><div forimg="1"><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/438cda16dd08523b962b435e.jpg" small="0" class="blogimg"/></div>
<br/><font color="#0000ff">源码：</font><br/><br/>
感觉这点注释差不多了。主要工作还是在字符串的切割上。<br/>
VB这玩意久了不用比较囧。<br/>
就像提取字符串的j个字符要用：<br/>
Mid(s, j, 1)<br/>
写C写多了，总有种写s(j)的冲动，想当成数组来用。<br/><br/><font color="#ff0000">先在“工程-&gt;引用”里面添加<br/>
Microsoft Excel 11.0 Object Library</font><br/>
要不会出现对象未定义。<br/><br/>
Option Explicit<br/><br/>
Private Sub Command1_Click()<br/><br/>
Dim excelApp As Excel.Application '定义EXCEL应用程序对象<br/>
Dim s, t As String<br/>
Dim curRow, curCol As Integer<br/>
Dim i, j As Integer<br/><br/>
Set excelApp = New Excel.Application '新建XCEL应用程序对象<br/>
On Error Resume Next '错误陷阱<br/>
excelApp.Visible = True '对象可见<br/><br/>
excelApp.Workbooks.Add '添加工作表<br/><br/>
curRow = Val(Text2.Text)<br/>
curCol = Val(Text3.Text)<br/>
s = Text1.Text<br/>
Trim (s)<br/><br/>
'去除字符前的空格，包括空格，制表符，回车换行<br/>
For j = 1 To Len(s)<br/>
        If Not (Asc(Mid(s, j, 1)) = 9 Or Asc(Mid(s, j, 1)) = 32 Or Asc(Mid(s, j, 1)) = 13 Or Asc(Mid(s, j, 1)) = 10) Then<br/>
            Exit For<br/>
        End If<br/>
Next j<br/>
s = Mid(s, j)<br/><br/>
With excelApp.ActiveSheet<br/>
        '处理整个字符串<br/>
        For i = 1 To Len(s)<br/>
            '搜寻下一个空格字符出现位置<br/>
            For j = i To Len(s)<br/>
                If Asc(Mid(s, j, 1)) = 9 Or Asc(Mid(s, j, 1)) = 32 Or Asc(Mid(s, j, 1)) = 13 Or Asc(Mid(s, j, 1)) = 10 Then<br/>
                   Exit For<br/>
                End If<br/>
            Next j<br/>
            '截取数据<br/>
            t = Mid(s, i, j - i)<br/>
            '写入EXCEL单元格<br/>
            .Cells(curRow, curCol).Value = t<br/>
            i = j<br/>
            '滤过之后的空格<br/>
            For j = i To Len(s)<br/>
                '如果有换行，调整当前行和当前列<br/>
                If Asc(Mid(s, j, 1)) = 13 Then<br/>
                    curRow = curRow + 1<br/>
                    curCol = Val(Text3.Text) - 1<br/>
                End If<br/>
                If Not (Asc(Mid(s, j, 1)) = 9 Or Asc(Mid(s, j, 1)) = 32 Or Asc(Mid(s, j, 1)) = 13 Or Asc(Mid(s, j, 1)) = 10) Then<br/>
                   Exit For<br/>
                End If<br/>
            Next j<br/>
            i = j - 1<br/>
            '移动到下一列<br/>
            curCol = curCol + 1<br/>
        Next i<br/>
End With<br/><br/>
End Sub<br/><br/><font color="#0000ff">后记：</font><br/><br/>
最近比较亢奋，搞东西搞得有点暴力。。。<br/>
不过这东西貌似留着以后也可以用。
