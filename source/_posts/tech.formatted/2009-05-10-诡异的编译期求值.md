---
layout: post
title: "诡异的编译期求值"
date: 2009-05-10  16:41
comments: true
categories: tech
tags: ["c","c++"]
_baiduhi_id: 1bbfb919aaa31d4d42a9ad3e.html
_baiduhi_category: c&c++
---

(hplonline)2009.5.10<br/><br/>
int main()<br/>
{<br/>
     int val ;<br/>
     val = 2147483647 &gt; -2147483648;<br/>
     cout&lt;&lt;val&lt;&lt;endl;<br/>
     val = 2147483647 &gt; -2147483647 - 1 ;<br/>
     cout&lt;&lt;val&lt;&lt;endl;<br/>
     return 0;<br/>
}<br/><br/>
结果：<br/><br/>
0<br/>
1<br/><br/>
就是这样。。。试了VC6,DEV结果都是。<br/><br/>
而val的值是在编译期就算好了的。比如：<br/>
00401798    mov      dword ptr [ebp-4], 0<br/><br/>
怀疑编译器默认是用无符号比较的。<br/><br/>
试一下转换：<br/><br/>
val = 2147483647 &gt; <font color="#ff0000">(signed)</font>-2147483648;<br/><br/>
出来的就是1了。。。<br/><br/>
而对后面一个式子的正确结果的解释是，<br/>
 -2147483647 - 1 <br/>
作为一个符号数的表达式，按照符号数运算。<br/>
同时做 &gt; 的时候也按照符号数比较，所以结果正确。<br/><br/>
看来使用常量const是一个好习惯。<br/>
可以尽量得到期望的值。<br/><br/>
比如：<br/>
const int a = 2147483647 ;<br/>
const int b = -2147483648 ;<br/><br/>
...<br/><br/>
val = a &gt; b ; <br/><br/>
这样通过const给相关的数据确定了是否带符号。<br/>
