---
layout: post
title: "常量区的问题（VC6.DEBUG , VC6.RELEASE)"
date: 2009-05-31  12:15
comments: true
categories: tech
tags: ["c","c++"]
_baiduhi_id: d97fdb43515f0e1b72f05d63.html
_baiduhi_category: c&c++
---

(hplonline)2009.5.31<br/><br/>
发现这个问题其实是在今年考二级前，<br/>
当时一哥们写了一个很逼真的程序，<br/>
最后调了一个晚上，我也去找了很久，<br/>
才发现关键所在，可见总有点东西忽略。<br/><br/>
后来一忙又搞忘记了，直到今天又看到类似的<font color="#0000ff">例子：</font><br/><br/>
int main(){<br/>
     char *p = "aaa" ;<br/>
     char q[] = "bbb" ;<br/>
     <br/>
     cout&lt;&lt;p[0]&lt;&lt;endl;<br/>
     cout&lt;&lt;q[0]&lt;&lt;endl;<br/>
   <font color="#339966"> //p[0] = '1' ;//这里要挂</font><br/>
     q[0] = '1' ;<br/><br/>
     return 0 ;<br/>
}<br/><br/>
可以试试注释掉的一句。<br/>
执行到那里程序就挂掉了。<br/><br/>
在VISTA下好像直接出关闭程序的框框，<br/>
在XP下好像有Access Violation。<br/><br/><font color="#0000ff">究其原因：</font><br/><br/>
     char q[] = "bbb" ;<br/>
这个是放在栈里面的。<br/>
所以可以随便读取修改。<br/><br/>
     char *p = "aaa" ;<br/>
这个的"aaa" 是放在常量区里面。<br/>
p只是个指针，存放了"aaa" 的地址。<br/><br/>
p[0]这种表达式，如果用于右值的话，是没有问题的。<br/>
但是用于左值，由于那块内存是只读的，于是就出问题了。<br/><br/>
但是注意到现在是在debug下玩的。<br/>
所以换到release下试试。<br/><br/><font color="#339966"><font color="#000000">p[0] = '1'<br/>
就可以不报错执行了</font><br/></font><br/>
可见，这种常量读写的检查是debug方式提供的特殊功能。<br/>
有助于排除此类改写常量导致的错误。<br/><font color="#0000ff"><br/>
其他关于Access Violation的琐碎：</font><br/><br/>
一般发生这种错误的时候，直接F5运行，<br/>
弹出的框里面确定，IDE会自动停到Access Violation的句子上。<br/>
这个时候往往要检查的都是指针，数组下标一类的问题。<br/>
比如指针为空，数组下标越界等等。<br/><br/>
有个特点就是，往往越界出去的位置既不能读，也不能写。<br/><br/>
而上面的这个问题，可以看到指针指向的是有效的数据区，<br/>
并没有越界，明明是可以读取的，于是当他写入出错时，<br/>
就有点摸不着头脑了。。。<br/>
