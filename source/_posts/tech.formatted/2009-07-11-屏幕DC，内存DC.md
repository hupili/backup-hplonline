---
layout: post
title: "屏幕DC，内存DC"
date: 2009-07-11  20:38
comments: true
categories: tech
tags: ["Vc"]
_baiduhi_id: e3f5b4098c78b82d6a60fb6b.html
_baiduhi_category: Vc
---

(hplonline)2009.7.11<br/><br/>
今天某人说google map没有测距尺用。。。<br/>
要自己把图截下来，根据比例尺来量确实有点麻烦。<br/>
那就整个戳瓢程序来辅助。<br/><br/>
首先就是把屏幕保存下来。<br/>
这里只要创建一个屏幕DC，就可以把里面的图像弄出来了。<br/><br/>
下面这几句，就可以把屏幕的内容复制到自己的窗口上。<br/><br/>
     CDC scrdc ;<br/>
     scrdc.CreateDC("DISPLAY" , NULL , NULL , NULL) ;<br/>
     CClientDC(this).BitBlt(0 , 0 , m_xscr , m_yscr , &amp;scrdc , 0 , 0 , SRCCOPY) ;<br/><br/>
在自己的窗口上，就可以很方便地捕捉鼠标位置等等，<br/>
然后根据输入的比例尺，给出量出的距离。<br/><br/>
像去掉标题栏，全屏化窗口都是基本操作。<br/><br/>
碰到一个问题，就是开始一直没有把图存进内存DC里面。<br/>
在网上逛了一圈，发现了是怎么回事。<br/>
原来初始化的内存DC，没地方绘图，<br/>
要先创建一个兼容的屏幕大小的位图，然后选进这个DC才行。<br/><br/>
大概就是这样。<br/><br/>
     CDC scrdc ;<br/>
     scrdc.CreateDC("DISPLAY" , NULL , NULL , NULL) ;<br/>
     m_xscr = GetSystemMetrics(SM_CXSCREEN) ;<br/>
     m_yscr = GetSystemMetrics(SM_CYSCREEN) ;<br/>
     memdc.CreateCompatibleDC(NULL) ;<br/>
     membitmap.CreateCompatibleBitmap(<font color="#ff0000">&amp;scrdc</font> , m_xscr , m_yscr) ;<br/>
     memdc.SelectObject(&amp;membitmap) ;<br/><br/>
最后一个问题就是，刚开始截出来的图显示不正常。<br/>
才发现是创建兼容位图的时候，应该用屏幕DC，而不是内存DC，<br/>
把上面相应的那句换成：<br/><br/>
membitmap.CreateCompatibleBitmap(<font color="#ff0000">&amp;memdc</font> , m_xscr , m_yscr) ;<br/><br/>
就会发现截出来的图变成黑白的一坨。。。<br/>
