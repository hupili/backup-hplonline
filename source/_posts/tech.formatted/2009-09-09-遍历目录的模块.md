---
layout: post
title: "遍历目录的模块"
date: 2009-09-09  18:37
comments: true
categories: tech
tags: ["Vc"]
_baiduhi_id: b0aea73439bb4fbed1a2d349.html
_baiduhi_category: Vc
---

<p>(hplonline)2009.9.9</p>
<p>经常会用到的操作，<br/>
遍历某个文件夹（包括其子目录），<br/>
然后对其中的文件进行某种操作。</p>
<p>SearchDir函数可以完成这个功能，<br/>
传入OPFUNC类型的回调函数即可。<br/>
OPFUNC可以得到每个文件名，并决定作何操作。<br/>
下面的程序演示了输出d:\下的所有文件名的方法。<br/>
关于路径的习惯，根目录后面是带'\'的，<br/>
而其他目录是不带'\'的。<br/>
我也觉得这是个很别扭的事情，<br/>
但是前人都这么搞的，<br/>
也就跟着这么搞。</p>
<p>有的时候，最初的设计不周，<br/>
导致后人多写许多句if。。。</p>
<p>-----------------</p>
<p>#include &lt;windows.h&gt;<br/>
#include &lt;stdio.h&gt;<br/>
#include &lt;string.h&gt;</p>
<p>char Dir[] = "d:\\" ;</p>
<p>typedef void (*OPFUNC)(char *filename) ;</p>
<p><font color="#ff0000">void myOperation(char *filename){<br/>
     puts(filename) ;<br/>
}</font></p>
<p>void SearchDir(char *dir , OPFUNC func){<br/>
     WIN32_FIND_DATA wfd ; <br/>
     char szCurDir[MAX_PATH] ;<br/>
     char szFind[MAX_PATH] ;<br/>
     strcpy(szCurDir , dir) ;<br/>
     int len = strlen(szCurDir) ;<br/>
     //is root directory or not <br/>
     if ( szCurDir[len - 1] != '\\' ) {<br/>
         strcat(szCurDir , "\\") ;     <br/>
     }<br/>
     strcpy(szFind , szCurDir) ;<br/>
     strcat(szFind , "*.*") ;</p>
<p>     HANDLE hFind=FindFirstFile(szFind , &amp;wfd) ; <br/>
     if ( hFind == INVALID_HANDLE_VALUE ) {<br/>
         return ;<br/>
     }else{<br/>
         do{<br/>
             //filtering the current directory and its parent<br/>
             if ( wfd.cFileName[0] == '.' ) continue ;<br/>
             char szFileName[MAX_PATH] ;<br/>
             sprintf(szFileName , "%s%s" , szCurDir , wfd.cFileName ) ;<br/>
             //this is a directory and do recursion<br/>
             if ( wfd.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY ) {<br/>
                 SearchDir(szFileName , func) ;<br/>
             }else{<br/>
                 (*func)(szFileName) ;<br/>
             }<br/>
         }while ( FindNextFile(hFind , &amp;wfd) ) ;<br/>
     }<br/>
     FindClose(hFind) ;<br/>
}</p>
<p>int main(){<br/>
     char sDir[MAX_PATH] ;<br/>
     SearchDir(Dir , myOperation) ;<br/>
     system("pause") ;<br/>
     return 0 ;<br/>
}</p>
