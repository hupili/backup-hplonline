---
layout: post
title: "格式化RFC文档"
date: 2009-10-05  20:27
comments: true
categories: tech
tags: ["c","c++"]
_baiduhi_id: b7f4a2d39e567e3e960a1659.html
_baiduhi_category: c&c++
---

<p>(hplonline)2009.10.5</p>
<p><font color="#0000ff">起因：</font></p>
<p>RFC文档的介绍：<a href="http://baike.baidu.com/view/6108.htm">http://baike.baidu.com/view/6108.htm</a><br/>
对于学习网络来说，是相当重要的资料。</p>
<p>可以在IETF的网站上下载：<br/><a href="http://www.ietf.org/rfc/rfcXXXX.txt">http://www.ietf.org/rfc/rfcXXXX.txt</a><br/>
XXXX换成编号对应的编号。</p>
<p>比较郁闷的是，文档是按照txt格式发布的，<br/>
而且文档很长，往往都有上百页，<br/>
随便打开一个，即可看到细细的滚动条。。。<br/>
浏览起来可谓不方便。</p>
<p>在网上搜了下，也有些做了这个的软件，<br/>
不过就这么个功能还要<font color="#ff0000">注册</font>，囧。<br/>
于是自己弄一个基本的，把txt转成html，<br/>
主要完成这些功能：<br/><font color="#ff9900">1.分页存为.htm文件<br/>
2.每页后面加上previous,next,return<br/>
    这几个功能，表示上一页，下一页，返回目录<br/>
3.识别为目录的条目，添加超链接到对应的.htm文件<br/>
4.将每页的头两行（页号行，rfc编号行）加色，主要是减缓视觉疲劳。。</font></p>
<p>实现上需要考虑的一点东西：<br/><font color="#ff9900">1.每页很标准的56行，这样可以简化分页工作<br/>
2.txt文档中的诸如空格，小于号等需要替换成html实体<br/>
3.生成目录页content.htm，其他的按照页码排为xxx.htm<br/>
4.将文章居中，但是又要保持段落本身的缩进，</font><br/>
     开始试着用&lt;center&gt;&lt;/center&gt;标签来做，<br/>
     组合了如&lt;p&gt;&lt;div&gt;&lt;span&gt;等等，没达到效果。<br/>
     最后是：<br/>
     &lt;table align=center&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;<br/>
     文字文字&lt;br&gt;<br/>
     文字文字&lt;br&gt;<br/>
     &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;<br/>
     这样解决的。<br/>
     （非常感谢<a target="_blank" href="http://www.shallway.net/">shallway</a>同学）</p>
<p><font color="#0000ff">程序：</font></p>
<p>（<font color="#ff0000">为了简化程序，在当前目录下手工建立名为"rfc"的文件夹，否则无法使用</font>）</p>
<p>#include &lt;stdio.h&gt;<br/>
#include &lt;string.h&gt;</p>
<p>const int PAGE_LINE = 56 ;</p>
<p>#define TEXT_BEGIN "&lt;table align=center&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;"<br/>
#define TEXT_END "&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;"</p>
<p>const char single_char[] = {' ' , '&lt;' , '&gt;' , '&amp;' , '\"' , '\'' } ;<br/>
const char *entity_name[] = {"&amp;#160;" , "&amp;#60;" , "&amp;#62;" , "&amp;#38;" , "&amp;#34;" , "&amp;#39;" } ;<br/>
const int entity_num = sizeof(single_char) ;<br/>
//conert between html entity and visual element<br/>
void convert(char *src , char *dst){<br/>
     int n , i ;<br/>
     while ( *src ){<br/>
         for ( i = 0 ; i &lt; entity_num ; i ++ ){<br/>
             if ( single_char[i] == *src ) break ;<br/>
         }<br/>
         if ( i == entity_num ){<br/>
             *dst = *src ;<br/>
             dst ++ ;<br/>
         }else{<br/>
             n = sprintf(dst , "%s" , entity_name[i]) ;<br/>
             dst += n ;<br/>
         }         <br/>
         src ++ ;<br/>
     }<br/>
     *dst = '\0' ;<br/>
}</p>
<p>//make a content with link to the pages<br/>
void make_link(char *s , FILE *fp){<br/>
     char *p = strstr(s , "....") ;<br/>
     if ( !p ) return ;<br/>
     char tmp1[1000] , tmp2[1000] ;<br/>
     int page ;<br/>
     sscanf(p , "%[^0123456789]%d" , tmp1 , &amp;page) ;<br/>
     convert(s , tmp1) ;<br/>
     sprintf(tmp2 , "&lt;a href=%d.htm&gt;%s&lt;/a&gt;" , page , tmp1) ;<br/>
     fprintf(fp , "%s&lt;br&gt;\n" , tmp2) ;<br/>
}</p>
<p>//add color to title<br/>
//just to avoid visual fatigue<br/>
void add_title_color(char *src , char *dst){<br/>
     sprintf(dst , "&lt;font color = red&gt;%s&lt;/font&gt;" , src) ;<br/>
}</p>
<p>int main(){<br/>
     freopen("rfc.txt" , "r" , stdin) ;<br/>
     int i = 0 , file = 0 ;<br/>
     char buf[1000] ;<br/>
     char addr[500] ;<br/>
     char text[1000] ;</p>
<p>     //reopen file for each page <br/>
     freopen("rfc\\0.htm" , "w" , stdout) ;<br/>
     printf(TEXT_BEGIN) ;</p>
<p>     //for the content<br/>
     FILE *fp = fopen("rfc\\content.htm" , "w") ;<br/>
     fprintf(fp , "&lt;p&gt;&lt;center&gt;&lt;font color = red size = 24&gt;content&lt;/font&gt;&lt;/center&gt;&lt;/p&gt;&lt;p&gt;&lt;center&gt;\n") ;<br/>
     <br/>
     while ( gets(buf) ){<br/>
         i ++ ;<br/>
         if ( i == PAGE_LINE ) {<br/>
             int pre = file - 1 ;<br/>
             int next = file + 1 ;<br/>
             if ( pre &lt; 0 ) pre = 0 ;<br/>
             printf("&lt;center&gt;&lt;a href=%d.htm&gt;【previous】&lt;/a&gt;"<br/>
                 "&amp;#160;&amp;#160;&amp;#160;&amp;#160;"<br/>
                 "&lt;a href=%d.htm&gt;【next】&lt;/a&gt;"<br/>
                 "&amp;#160;&amp;#160;&amp;#160;&amp;#160;"<br/>
                 "&lt;a href=content.htm&gt;【return】&lt;/a&gt;&lt;/center&gt;", pre , next) ;<br/>
             i = 0 ;<br/>
             file ++ ;<br/>
             sprintf(addr , "rfc\\%d.htm" , file) ;<br/>
             printf(TEXT_END) ;<br/>
             freopen(addr , "w" , stdout) ;<br/>
             printf(TEXT_BEGIN) ;<br/>
         }<br/>
         if ( file &lt; 10 ) {<br/>
             //assume content appears only in the beginning <br/>
             //maybe 9 pages .<br/>
             make_link(buf , fp) ;<br/>
         }<br/>
         convert(buf , text) ;<br/>
         if ( i == 2 || i == 4 ){<br/>
             strcpy(buf , text) ;<br/>
             add_title_color(buf , text) ;<br/>
         }<br/>
         printf("%s&lt;br&gt;" , text) ;<br/>
     }<br/>
     <br/>
     //end of pages<br/>
     printf("&lt;center&gt;&lt;a href=%d.htm&gt;【previous】&lt;/a&gt;"<br/>
         "&amp;#160;&amp;#160;&amp;#160;&amp;#160;"<br/>
         "&amp;#160;&amp;#160;&amp;#160;&amp;#160;"<br/>
         "&lt;a href=content.htm&gt;【return】&lt;/a&gt;&lt;/center&gt;"<br/>
         TEXT_END , file - 1) ;</p>
<p>     //end of content<br/>
     fprintf(fp , "&lt;/center&gt;&lt;/p&gt;") ;<br/>
     fclose(fp) ;<br/>
     return 0 ;<br/>
}</p>
<p><font color="#0000ff">后记：</font></p>
<p>现在仅仅实现一些基本的功能，<br/>
感觉有时间把这个做丰富还是相当有必要的，<br/>
毕竟以后可能有很多时间和RFC打交道。</p>
<p>暂时考虑到的功能：<br/><font color="#ff9900">1.为目录生成树状列表，转到任意页<br/>
2.搜索功能，关键词加亮<br/>
3.自动从IETF网站拉取任意编号的文档（只要存在）<br/>
4.更智能的格式化</font><br/>
     比如，下面这段话<br/>
     Every implementor is urged to read [INTRO:4] and<br/>
     应该为 [INTRO:4] 这样的加上超链接。<br/>
     又如，下面这个<br/>
     This document is an updated version of RFC 1716<br/>
     应该为 RFC 1716 加上链接到相关的文档。<br/><font color="#ff9900">5.书签功能<br/>
6.批注功能<br/>
7.更多的加色功能，主要用于缓解视觉疲劳</font></p>
<p> </p>
