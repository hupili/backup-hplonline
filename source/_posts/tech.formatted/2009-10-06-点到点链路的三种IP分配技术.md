---
layout: post
title: "点到点链路的三种IP分配技术"
date: 2009-10-06  22:05
comments: true
categories: tech
tags: ["Network"]
_baiduhi_id: 52fc6722a96262ae4723e879.html
_baiduhi_category: Network
---

(hplonline)2009.10.6<br/><br/>
》任务：总结点到点链路的三种IP分配技术的具体实现及其优缺点(参考RFC1812)<br/><font color="#0000ff"><br/>
》》先看前言</font><br/><br/>
In this, he stands squarely on the shoulders of those<br/>
who have gone before him, and depends largely on expert contributors<br/>
for text.  Any credit is theirs; the errors are his.<br/><br/>
老外很搞。。即使是写技术文档。<br/>
（所有的荣誉都是前辈的，所有的错误都是自己的）<br/><br/><font color="#0000ff">》》读下目录</font><br/><br/>
3.3.5 Point-to-Point Protocol - PPP ....................   35<br/>
估计在这一节里面<br/><br/>
5.3.7 Martian Address Filtering ........................   96<br/>
这个名词很好玩，火星地址。。。<br/>
读了下正文，其实就是指的禁止在网络上传送的地址，<br/>
比如专用地址，回路地址127等等。<br/><br/><font color="#0000ff">》》浏览一下简介(introduction)</font><br/><br/>
This memo should be read in conjunction with the Requirements for<br/>
Internet Hosts RFCs ([INTRO:2] and [INTRO:3]).  Internet hosts and<br/>
routers must both be capable of originating IP datagrams and receiving<br/>
IP datagrams destined for them.  The major distinction between<br/>
Internet hosts and routers is that routers implement forwarding<br/>
algorithms, while Internet hosts do not require forwarding<br/>
capabilities.  Any Internet host acting as a router must adhere to the<br/>
requirements contained in this memo.<br/><br/>
指出Internet主机和路由都能够发包和收取目的地为他们自身的IP包。<br/>
基于这个定义（或requirement），一个路由器也应该具有IP地址。<br/>
（虽然按照常理来看，点到点链路只有唯一出口，不用考虑IP地址也应该转发）<br/><br/><font color="#0000ff">》》跳到3.3.5节</font><br/><br/>
》》》3.3.5.1 introduction<br/><br/>
It is critical that an implementor understand the semantics of the<br/>
option negotiation mechanism.  Options are a means for a local device<br/>
to indicate to a remote peer what the local device will accept from<br/>
the remote peer, not what it wishes to send.  It is up to the remote<br/>
peer to decide what is most convenient to send within the confines of<br/>
the set of options that the local device has stated that it can<br/>
accept.  Therefore it is perfectly acceptable and normal for a remote<br/>
peer to ACK all the options indicated in an LCP Configuration Request<br/>
(CR) even if the remote peer does not support any of those options.<br/>
Again, the options are simply a mechanism for either device to<br/>
indicate to its peer what it will accept, not necessarily what it<br/>
will send.<br/><br/>
本地提出option，远端决定最适合的选项。<br/>
最好情况下，远端会ACK所有的选项。<br/>
LCP配置选项仅仅是用来向对端指出可以接收的，<br/>
并非必要发送的。<br/><br/>
》》》3.3.5.2 Link Control Protocol (LCP) Options<br/><br/>
The PPP Link Control Protocol (LCP) offers a number of options that<br/>
may be negotiated.  These options include (among others) address and<br/>
control field compression, protocol field compression, asynchronous<br/>
character map, Maximum Receive Unit (MRU), Link Quality Monitoring<br/>
(LQM), magic number (for loopback detection), Password Authentication<br/>
Protocol (PAP), Challenge Handshake Authentication Protocol (CHAP),<br/>
and the 32-bit Frame Check Sequence (FCS).<br/><br/>
可能协商的选项：<br/>
地址，控制字段压缩，协议字段压缩，异步字符表，最大接收单元，<br/>
链路质量监测，magic number（。。。？），密码认证协议，<br/>
挑战握手认证协议，32bit的帧校验序列（FCS)<br/><br/>
（之后有各项的“讨论”和“实现”）<br/><br/>
》》》3.3.5.3 IP Control Protocol (IPCP) Options<br/><br/>
Routers operating at link speeds of 19,200 BPS or less SHOULD<br/>
implement and offer to perform Van Jacobson header compression.<br/>
Routers that implement VJ compression SHOULD implement an<br/>
administrative control enabling or disabling it.<br/><br/>
链路速度在19200BPS以下需要实现VJ头压缩策略，<br/>
实现VJ压缩策略的路由器需要同时实现可管理的“开启/禁止”开关。<br/><br/><font color="#0000ff">》》发现老师提示了阅读2.2.7节。于是跳过去</font><br/><br/>
Traditionally, each network interface on an IP host or router has its<br/>
own IP address.  This can cause inefficient use of the scarce IP<br/>
address space, since it forces allocation of an IP network prefix to<br/>
every point-to-point link.<br/><br/>
传统上，每个主机或者路由的每个接口都分有IP。<br/>
在每个P2P链路上也分配得有IP地址，<br/>
这样会浪费本来就很稀缺的IP地址资源。<br/><br/>
To solve this problem, a number of people have proposed and<br/>
implemented the concept of unnumbered point to point lines.  An<br/>
unnumbered point to point line does not have any network prefix<br/>
associated with it.  As a consequence, the network interfaces<br/>
connected to an unnumbered point to point line do not have IP<br/>
addresses.<br/><br/>
人们发明了无编号的P2P线路，<br/>
无编号P2P线路没有与之相关的网络前缀，<br/>
所以该线路上的网络接口没有IP地址。<br/><br/><br/>
Because the IP architecture has traditionally assumed that all<br/>
interfaces had IP addresses, these unnumbered interfaces cause some<br/>
interesting dilemmas.  For example, some IP options (e.g., Record<br/>
Route) specify that a router must insert the interface address into<br/>
the option, but an unnumbered interface has no IP address.  Even more<br/>
fundamental (as we shall see in chapter 5) is that routes contain the<br/>
IP address of the next hop router.  A router expects that this IP<br/>
address will be on an IP (sub)net to which the router is connected.<br/>
That assumption is of course violated if the only connection is an<br/>
unnumbered point to point line.<br/><br/>
由于IP架构假设所有的接口都有IP地址，导致了若干窘境。<br/>
如，一些IP选项要求路由器把接口地址插入其中，<br/>
但无编号的接口没有IP地址。<br/><br/>
更为基本的是，路由（信息）包含吓一跳路由的IP地址，<br/>
路由器期望这个地址是在其所直连的网路（子网）上面。<br/>
当仅有的连接为一条P2P链路的时候，<br/>
该假设被破坏掉了。<br/><br/>
To get around these difficulties, two schemes have been conceived.<br/>
The first scheme says that two routers connected by an unnumbered<br/>
point to point line are not really two routers at all, but rather two<br/>
half-routers that together make up a single virtual router.  The<br/>
unnumbered point to point line is essentially considered to be an<br/>
internal bus in the virtual router.  The two halves of the virtual<br/>
router must coordinate their activities in such a way that they act<br/>
exactly like a single router.<br/><br/>
方案一：<br/>
将P2P线路所连的两个路由器看作一个虚拟路由器。<br/>
无编号的P2P线路被当作虚拟路由器的内部总线。<br/>
虚拟路由器的两半需要协调其行为，<br/>
以便从外部看来像一个路由器。<br/><br/><br/>
This scheme fits in well with the IP architecture, but suffers from<br/>
two important drawbacks.  The first is that, although it handles the<br/>
common case of a single unnumbered point to point line, it is not<br/>
readily extensible to handle the case of a mesh of routers and<br/>
unnumbered point to point lines.  The second drawback is that the<br/>
interactions between the half routers are necessarily complex and are<br/>
not standardized, effectively precluding the connection of equipment<br/>
from different vendors using unnumbered point to point lines.<br/><br/>
该方案能很好地适应IP架构，但在两方面存在缺陷。<br/>
第一方面是，它虽然能很好地处理常规的单条P2P线路，<br/>
但并非能稳定地扩展到处理一个路由网络以及若干无编号P2P线路。<br/>
第二方面是，两个 半路由器 间的交互非常复杂，并且非标准化，<br/>
导致不同生产商提供的设备使用P2P线路连接受阻。<br/><br/><br/>
Because of these drawbacks, this memo has adopted an alternate<br/>
scheme, which has been invented multiple times but which is probably<br/>
originally attributable to Phil Karn.  In this scheme, a router that<br/>
has unnumbered point to point lines also has a special IP address,<br/>
called a router-id in this memo.  The router-id is one of the<br/>
router's IP addresses (a router is required to have at least one IP<br/>
address).  This router-id is used as if it is the IP address of all<br/>
unnumbered interfaces.<br/><br/>
该备忘录采用一个变通的方法，<br/>
给无编号P2P线路上的路由分配一个特殊IP地址，<br/>
在该备忘录里面，被称为router-id。<br/>
router-id是路由器所具有的某个IP地址<br/>
（一个路由器至少要有一个IP地址）。<br/>
这个router-id被当作所有无编号接口的IP地址。<br/><br/><font color="#0000ff">》》搜索“unnumbered”关键词</font><br/><br/>
》》》4.2.2.2 Addresses in Options: RFC 791 Section 3.1<br/><br/>
Each unnumbered interface<br/>
MUST be associated with a particular router-id.  This association<br/>
MUST NOT change (even across reboots) without reconfiguration of the<br/>
router.<br/><br/>
每一个无编号的接口都要与一个独特的（唯一？）的router-id关联。<br/>
这个关联除非重新配置，否则即使重启也不应该改变。<br/><br/>
---------------------------------<br/>
差不多读了这些就知道个大概了。<br/><font color="#ff9900">1.直接给IP是一种方法<br/>
2.虚拟路由器，（不分配也是一种分配。。。具体情况与马哲老师讨论）<br/>
3.router-id（路由器的某个IP）</font><br/>
