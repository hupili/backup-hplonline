---
layout: post
title: "802.1X的主动和被动模式"
date: 2010-06-03  15:50
comments: true
categories: tech
tags: ["Network"]
_baiduhi_id: 67e34136c5b5d2d1a2cc2b75.html
_baiduhi_category: Network
---

(hplonline)2010.6.3<br/><br/>
今天接入网实验又弄了一次802.1X，<br/>
比较了主动和被动的一点区别。<br/><br/>
从客户端的现象上来说，应该都是一样的；<br/>
交换机和RADIUS服务器之间的交互没法抓包，故没研究；<br/>
所以主要是从客户端抓包，看下区别。<br/><br/><font color="#0000ff">》》环境</font><br/><br/>
交换机：RG-S2026F<br/>
PC：XP<br/>
认证方式：MD5质询<br/><br/><font color="#0000ff">》》认证模型简述：</font><br/><br/>
客户&lt;--&gt;交换机&lt;--&gt;RADIUS服务器<br/><br/>
802.1X是跑在客户和交换机这一段。<br/><br/>
理论上，客户主动发起的认证过程为：<br/>
--&gt;EAPOL-start<br/>
&lt;--EAP-identity-request<br/>
--&gt;EAP-identity-response<br/>
&lt;--EAP-MD5-Challenge-request<br/>
--&gt;EAP-MD5-Challenge-respone<br/>
&lt;--EAP-Success<br/><br/>
理论上，由认证PAE（交换机）发起的认证为：<br/>
&lt;--EAP-identity-request<br/>
--&gt;EAP-identity-response<br/>
&lt;--EAP-MD5-Challenge-request<br/>
--&gt;EAP-MD5-Challenge-respone<br/>
&lt;--EAP-Success<br/><br/><font color="#0000ff">》》交换机被动模式的交互序列（默认配置）</font><br/><br/><span><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/ab4bc711d1b8552cb8127b3d.jpg" small="0" class="blogimg"/></span><br/><br/>
和理论上的过程是一致的。<br/><br/><font color="#0000ff">》》交换机主动模式的交互序列</font><br/><br/><span><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/c14806f47e9ed9d37709d73d.jpg" small="0" class="blogimg"/></span><br/><br/>
因为有一些其他的干扰报文，只关注类型为EAP几个。<br/><br/>
在交换机主动模式下，查找前后报文，看不到EAPOL-start。<br/>
而这几个比较集中的报文中，初看起来，缺少了EAP-identity-request。<br/>
如果再向前面找一下，<font color="#ff0000">有的时候</font>是可以发现一个EAP-identity-request的，<br/>
如果有该报文，一般可能与集中的部分都隔得比较远。<br/><br/><font color="#0000ff">》》现象总结</font><br/><br/>
从抓包的结果来看，EAPOL-start这个包是没有看到的。<br/>
而不管在主动模式和被动模式下，抓下来的都是同样的5个报文。<br/>
区别在于交换机主动模式下，EAP-identity-request会在认证报文集中位置的前面。<br/><br/><font color="#0000ff">》》分析</font><br/><br/>
在被动模式下，当客户需要认证的时候，会触发交换机的认证。<br/>
具体来说，就是在XP中输入用户名和密码，点确定，<br/>
之后交换机用一个EAP-identity-request开启认证过程。<br/>
这里肯定是有触发的机制的，既然不是EAPOL-start，<br/>
肯定是有其他东西的，这个还得再细看。<br/><br/>
在主动模式下，交换机检测到链路有效，则开始认证。<br/>
为了触发XP中输入认证信息的气泡框，<br/>
我们的操作是先禁用网卡，然后启用。<br/>
而网卡要启用后，在Wireshark中才会看到 ，进而开始抓包。<br/>
网卡一启用，交换机立即检测到，并且发送EAP-identity-request准备开始认证。<br/>
这个时候，Wireshark上可能还没有开始抓包，<br/>
于是出现了看不到EAP-identity-request的情况。<br/>
有的时候，操作比较快，当然就看到了EAP-identity-request。<br/><br/>
在用户输入账户信息之前，XP收到EAP-identity-request，<br/>
于是状态发生转换，所以输入账户之后，<br/>
可以直接从EAP-identity-response开始认证交互。<br/><br/><br/>
