---
layout: post
title: "离校前酱油最后一个比赛（数独游戏）"
date: 2010-07-10  17:44
comments: true
categories: tech
tags: ["Vc"]
_baiduhi_id: d217f603afa3a985d53f7cb9.html
_baiduhi_category: Vc
---

(hplonline)2010.7.9<br/><br/>
游戏，源码，工程，文档：<a href="http://www.box.net/shared/cqvr7du92i" target="_blank">下载</a><br/>
（比赛提交的原样内容）<br/><br/><font color="#0000ff">》》背景：</font><br/><br/>
华为这次也是拖了够久了，都要吐血了。<br/>
这效率。。。唉。。只能说唉。。<br/><br/>
比赛从早上9点一直刚到下午5点，<br/>
中午管饭的，但饮水机缺水好几次。。<br/>
找的房间没空调，急得人直冒汗。<br/>
比到半截，刚不起了，下楼找实验室，<br/>
自带了一个风扇，继续写。。<br/><br/>
说来也是奇怪，<br/>
一个号称的程序设计大赛居然和通信合作。<br/>
这种事情再怎么也要找计算机的专业点吧。<br/>
通信的机房倒是安了一堆CCS这样我们不用的东西，<br/>
结果连最基本的MSDN都没有。<br/>
于是最初为了绘那几个界面，<br/>
折腾了半天，连猜带懵加看头文件。<br/><br/>
这学期毕设一直是用C#酱油界面，<br/>
搞得VC的一套都很生疏了。<br/>
最后利用的强大的windows画图板，<br/>
把题目说明中的图样修改了下，<br/>
弄成了背景，和鼠标悬停高亮的样子。<br/><br/>
不过VC就是好，虽然记不清楚细节，<br/>
但只要有点想法，总有变通解决方案。<br/>
如果是C#就惨了，很多东西不知道就没法用，<br/>
真正做的时候，也是需要什么搜什么。<br/><br/>
算法方面就更酱油了，<br/>
按理说一天纯写算法的话也够多种优化了。<br/>
记得以前看过<a href="http://blog.csdn.net/mathe/archive/2007/08/23/1755672.aspx" target="_blank">mathe总结的数独</a>，<br/>
大概有10来种直接推法。<br/>
大部分的数独都可以直接用这些方法推出，<br/>
只用进行一点点的枚举就行了，<br/>
真是总结得很到位，太强大了。<br/>
上面链接过去能找到他做的程序，<br/>
操作很方便，而且附带提示功能，<br/>
用于学习数独技巧也是很好的。<br/><br/>
最初没有想到是做这样的东西，<br/>
时间分配很不均匀。<br/>
前面基本上是学习绘图，做UI，<br/>
最后个多小时写的算法和文档。。<br/>
所以成品中的算法异常简陋，<br/>
只是有考虑候选数的回溯，<br/>
连唯一数和隐含唯一数两种最简单的判断都没写。<br/>
跑了下，题目附带的前20号游戏都能出结果，<br/>
时间耗得最长的也就是秒级，于是接受了。<br/><br/>
生成局面的算法，下来后才反应过来。<br/>
其实最简单的就是直接拿那20个有解的做种子，<br/>
从中间随机去掉一些数字就行了，<br/>
这样可以避免有解的判断。<br/>
当时是直接向上面填数字，<br/>
虽然是从候选数中填上的，<br/>
从直接局面看是无冲突的，<br/>
但最后也可能填到无解的情况。<br/><br/><font color="#0000ff">》》效果：</font><br/><br/><span><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/c762de3f91e20dfd7c1e71fb.jpg" small="0" class="blogimg"/></span><br/><br/>
点击左键弹出这样一个面板，可以输入数字或者候选数字。<br/>
感觉这个弹框比较丑，没时间做美化了。。<br/>
如果要删除某个输入的数字或者候选数字，在上面右击即可。<br/><br/><span><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/1e5905246cd1700cc99559fb.jpg" small="0" class="blogimg"/></span><br/><br/>
一个放大的细节。<br/>
橘黄色的是高亮当前格，<br/>
这个黄框也是从题目的word文档中改造过来的，<br/>
看起来总觉得不行。。<br/>
蓝色是原有的数字，红色是填入的数字，<br/>
小的斜体“3、5、4”是用户输入的可能候选数。<br/>
这个候选数只是辅助用户思考所用。<br/><br/><span><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/1bbfb919a9b21e7a42a9adc4.jpg" small="0" class="blogimg"/></span><br/><br/>
这是随手写的一个最简单的单格提示功能，<br/>
把每个格子用行列宫的规则判断后，<br/>
剩下能填的数都列在里面，帮助用户思考。<br/><br/><span><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/56fab312c78a6af1c2fd78fb.jpg" small="0" class="blogimg"/></span><br/><br/>
选择全部解答后，自动填上的数字。<br/><br/><span><img border="0" src="http://hiphotos.baidu.com/hplonline/pic/item/a973a301287ec7391c9583c4.jpg" small="0" class="blogimg"/></span><br/><br/><font color="#0000ff">》》改进：</font><br/><br/>
UI需要统一一下风格：<br/>
输入数字的弹窗，<br/>
载入游戏的弹窗，<br/>
生成新游戏的弹窗。<br/>
都弄成主界面这个样子的。<br/><br/>
增加撤销和重复操作的功能。<br/>
现在程序里面有的是删除数字的功能。<br/>
而撤销是带有顺序的，<br/>
可以删除一连串的填入。<br/>
这个很有必要，<br/>
因为前后数字的填入是有相关性的。<br/>
简单删除可能会由于误操作而形成混乱。<br/><br/>
高亮效果还是用DC直接画吧，<br/>
贴图的太不逼真了。。<br/>
而且还是mspaint修饰出来。。<br/>
特别是如果后面要加其他演示效果，<br/>
贴图叠在一起的样子可能更不好控制。<br/><br/>
算法上，确实差得比较远，<br/>
可以考虑向mathe谈到的几种靠近。<br/>
可以把各种提示的演示都加出来。<br/><br/>
不过说归说，这些都不打算做了，记下而已。<br/>
没想到酱油这么个小东西都折腾了一天。。<br/><font color="#0000ff"><br/>
》》关于绘图</font><br/><br/>
一般的小游戏，刷新不频繁，用DC就够了。<br/>
代码构造一般是：<br/>
输入事件的处理中，改变游戏状态，<br/>
必要的时候触发绘图事件。<br/>
绘图事件中，根据游戏状态依次绘制各个元素。<br/><br/>
触发绘图事件一般用Invalidate。<br/><br/>
如果绘图有闪烁，可以Invalidate(false)。<br/>
这样可以不用系统擦除背景，提高点效率。<br/><br/>
如果还是比较闪烁，可以考虑双缓冲。<br/>
先在一个兼容的内存DC里面画图，<br/>
画完后再一次性地bitblt到屏幕上面。<br/><br/>
